<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensos Web Proposal v2</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root" class="bg-black min-h-screen text-white flex items-center justify-center">
        <div class="text-center">
            <div class="text-neon text-2xl mb-4 animate-pulse">INITIALIZING SENSOS CORE...</div>
            <div class="text-gray-500 text-sm">Loading Neural Interface</div>
        </div>
    </div>
    <div id="debug-error" style="color: red; padding: 20px; display: none; background: white; position: fixed; top: 0; left: 0; z-index: 9999;"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const debugDiv = document.getElementById('debug-error');
            debugDiv.style.display = 'block';
            debugDiv.innerHTML += `<strong>Error:</strong> ${message}<br>at ${source}:${lineno}<br>`;
        };
    </script>

    <script type="text/babel">
        // --- SAFETY CHECK ---
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            throw new Error("React or ReactDOM failed to load. Please check your internet connection or CDN status.");
        }

        const { useState, useEffect, useRef } = React;
        
        // --- INLINE ICONS (No External Dependencies) ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Terminal = (props) => <Icon {...props}><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></Icon>;
        const Cpu = (props) => <Icon {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></Icon>;
        const ShieldAlert = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const Globe = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></Icon>;
        const DollarSign = (props) => <Icon {...props}><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>;
        const Crosshair = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const MapPin = (props) => <Icon {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const Server = (props) => <Icon {...props}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></Icon>;
        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></Icon>;
        const Brain = (props) => <Icon {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></Icon>;
        const Radio = (props) => <Icon {...props}><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></Icon>;
        const Mic = (props) => <Icon {...props}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></Icon>;
        const Volume2 = (props) => <Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></Icon>;
        const Share2 = (props) => <Icon {...props}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>;
        const ImageIcon = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></Icon>;
        const Loader = (props) => <Icon {...props}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></Icon>;

        // --- GEMINI API HELPERS ---
        
        function getApiKey() {
            // Check URL first
            const urlParams = new URLSearchParams(window.location.search);
            const keyFromUrl = urlParams.get('key');
            if (keyFromUrl) {
                localStorage.setItem('gemini_api_key', keyFromUrl);
                window.history.replaceState({}, document.title, window.location.pathname);
                return keyFromUrl;
            }
            return localStorage.getItem('gemini_api_key');
        }

        async function generateText(prompt) {
          const apiKey = getApiKey();
          if (!apiKey) return "MISSING_KEY";
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: prompt }] }],
                }),
              }
            );
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "System Error.";
          } catch (error) {
            console.error("Text Gen Error:", error);
            return "Connection Lost.";
          }
        }

        async function generateImage(prompt) {
          const apiKey = getApiKey();
          if (!apiKey) return null;
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  instances: [{ prompt: prompt + " in a dark, gritty, cyberpunk logistics aesthetic, high contrast, neon accents, photorealistic, cinematic lighting" }],
                  parameters: { sampleCount: 1 }
                }),
              }
            );
            const data = await response.json();
            if (data.predictions && data.predictions[0] && data.predictions[0].bytesBase64Encoded) {
              return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
            }
            return null;
          } catch (error) {
            console.error("Image Gen Error:", error);
            return null;
          }
        }

        async function generateSpeech(text) {
          const apiKey = getApiKey();
          if (!apiKey) return null;
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: text }] }],
                  generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                      voiceConfig: {
                        prebuiltVoiceConfig: { voiceName: "Kore" } // Kore sounds authoritative/AI-like
                      }
                    }
                  }
                }),
              }
            );
            const data = await response.json();
            const audioContent = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
            if (audioContent) {
              return audioContent;
            }
            return null;
          } catch (error) {
            console.error("TTS Error:", error);
            return null;
          }
        }

        // --- UTILS ---
        // Helper to decode PCM16 audio (Gemini TTS format) to WAV for browser playback
        function base64ToWav(base64PCM) {
            const binaryString = window.atob(base64PCM);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            // PCM data is raw samples. To play in browser, we wrap in WAV container.
            // 24000Hz is standard for this model usually, mono.
            const sampleRate = 24000;
            const numChannels = 1;
            const bitsPerSample = 16;
            const blockAlign = numChannels * bitsPerSample / 8;
            const byteRate = sampleRate * blockAlign;
            const dataSize = bytes.length;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            // RIFF identifier
            writeString(view, 0, 'RIFF');
            // file length
            view.setUint32(4, 36 + dataSize, true);
            // RIFF type
            writeString(view, 8, 'WAVE');
            // format chunk identifier
            writeString(view, 12, 'fmt ');
            // format chunk length
            view.setUint32(16, 16, true);
            // sample format (raw)
            view.setUint16(20, 1, true);
            // channel count
            view.setUint16(22, numChannels, true);
            // sample rate
            view.setUint32(24, sampleRate, true);
            // byte rate (sample rate * block align)
            view.setUint32(28, byteRate, true);
            // block align (channel count * bytes per sample)
            view.setUint16(32, blockAlign, true);
            // bits per sample
            view.setUint16(34, bitsPerSample, true);
            // data chunk identifier
            writeString(view, 36, 'data');
            // data chunk length
            view.setUint32(40, dataSize, true);

            // Write the PCM samples
            const pcmData = new Uint8Array(buffer, 44);
            pcmData.set(bytes);

            return new Blob([buffer], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
          for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
          }
        }

        // --- NOTIFICATIONS (Webhook-based) ---
        function getNotifyUrl() {
          const urlParams = new URLSearchParams(window.location.search);
          const fromUrl = urlParams.get('notify');
          if (fromUrl) {
            localStorage.setItem('notify_url', fromUrl);
            // Clean URL of the notify param
            urlParams.delete('notify');
            const newSearch = urlParams.toString();
            const newUrl = window.location.pathname + (newSearch ? `?${newSearch}` : '') + window.location.hash;
            window.history.replaceState({}, document.title, newUrl);
          }
          const saved = localStorage.getItem('notify_url');
          if (saved) return saved;
          // Prefill with a working, no-setup echo endpoint
          const DEFAULT_NOTIFY = 'https://postman-echo.com/post';
          localStorage.setItem('notify_url', DEFAULT_NOTIFY);
          return DEFAULT_NOTIFY;
        }

        async function notifyEvent(eventName, payload = {}, options = {}) {
          try {
            const url = getNotifyUrl();
            const interactive = !!options.interactive;
            if (!url) {
              // Fallback: open a mailto draft (no setup, no cost)
              const subject = encodeURIComponent(`[Sensos] ${eventName}`);
              const body = encodeURIComponent(JSON.stringify({
                event: eventName,
                at: new Date().toISOString(),
                href: window.location.href,
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                ...payload,
              }, null, 2));
              // Use a short debounce to avoid multiple prompts
              if (interactive && !window.__mailtoDebounce) {
                window.__mailtoDebounce = setTimeout(() => { window.__mailtoDebounce = null; }, 2000);
                window.location.href = `mailto:caseyglarkin2@gmail.com?subject=${subject}&body=${body}`;
              }
              return;
            }
            const body = {
              event: eventName,
              at: new Date().toISOString(),
              href: window.location.href,
              userAgent: navigator.userAgent,
              referrer: document.referrer,
              ...payload,
            };
            await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body),
              keepalive: true,
            });
          } catch (e) {
            console.warn('notifyEvent failed', e);
          }
        }


        const styles = `
          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

          :root {
            --bg-dark: #050505;
            --neon-cyan: #00FFC2;
            --alert-red: #FF2A00;
          }

          body {
            background-color: var(--bg-dark);
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
          }

          .mono {
            font-family: 'JetBrains Mono', monospace;
          }

          .text-neon {
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 255, 194, 0.5);
          }

          .border-neon {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 194, 0.2);
          }

          .bg-neon {
            background-color: var(--neon-cyan);
          }

          .text-alert {
            color: var(--alert-red);
            text-shadow: 0 0 10px rgba(255, 42, 0, 0.5);
          }

          .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 194, 0.02) 51%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
          }

          .glitch-wrapper {
            position: relative;
            display: inline-block;
          }

          .glitch-wrapper::before, .glitch-wrapper::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
          }

          .glitch-wrapper::before {
            left: 2px;
            text-shadow: -1px 0 #FF2A00;
            clip-path: inset(20% 0 80% 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
          }

          .glitch-wrapper::after {
            left: -2px;
            text-shadow: -1px 0 #00FFC2;
            clip-path: inset(60% 0 10% 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
          }

          @keyframes glitch-anim {
            0% { clip-path: inset(10% 0 90% 0); }
            20% { clip-path: inset(60% 0 10% 0); }
            40% { clip-path: inset(30% 0 50% 0); }
            60% { clip-path: inset(80% 0 5% 0); }
            80% { clip-path: inset(10% 0 60% 0); }
            100% { clip-path: inset(40% 0 20% 0); }
          }

          @keyframes glitch-anim-2 {
            0% { clip-path: inset(15% 0 80% 0); }
            20% { clip-path: inset(80% 0 10% 0); }
            40% { clip-path: inset(40% 0 50% 0); }
            60% { clip-path: inset(10% 0 40% 0); }
            80% { clip-path: inset(70% 0 20% 0); }
            100% { clip-path: inset(20% 0 70% 0); }
          }

          .bar {
            animation: sound 0ms -800ms linear infinite alternate;
          }

          @keyframes sound {
            0% { opacity: .35; height: 3px; }
            100% { opacity: 1; height: 100%; }
          }
        `;

        // Section Header Component
        const SectionHeader = ({ title, subtitle, number }) => (
          <div className="flex items-end gap-4 mb-12 border-b border-gray-800 pb-4">
            <span className="mono text-neon text-4xl font-bold opacity-50">{number}</span>
            <div>
              <h2 className="text-4xl font-bold uppercase tracking-tighter glitch-wrapper" data-text={title}>{title}</h2>
              <p className="mono text-gray-500 text-sm mt-1 uppercase tracking-widest">{subtitle}</p>
            </div>
          </div>
        );

        // Hero Component
        const Hero = () => {
          return (
            <section className="min-h-screen flex flex-col justify-center relative px-6 md:px-20 pt-20 overflow-hidden">
              <div className="absolute top-0 right-0 w-1/2 h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] pointer-events-none"></div>
              
              <div className="z-10 max-w-5xl">
                <div className="flex items-center gap-2 mb-6">
                  <span className="animate-pulse w-3 h-3 bg-neon rounded-full"></span>
                  <span className="mono text-neon text-sm">SYSTEM: SECURE // CONNECTED TO LIA CORE</span>
                </div>
                
                <h1 className="text-6xl md:text-8xl font-black uppercase leading-[0.9] mb-8 tracking-tight">
                  You Merely <span className="text-gray-600">Adopted</span> <br/>
                  The Supply Chain. <br/>
                  We Were <span className="text-neon glitch-wrapper" data-text="BORN IN IT">BORN IN IT</span>.
                </h1>

                <p className="text-xl md:text-2xl text-gray-400 max-w-2xl leading-relaxed border-l-4 border-neon pl-6 mb-10">
                  Most agencies see trucks and boxes. We see the 3 AM detention fees. 
                  We see the AOG burning cash on the tarmac. 
                  <br/><br/>
                  <span className="text-white font-bold">Sensos needs a weapon, not a brochure.</span>
                </p>

                <div className="flex flex-col md:flex-row gap-4">
                  <a href="#proposal" className="group bg-neon text-black px-8 py-4 font-bold text-lg uppercase tracking-wide flex items-center gap-2 hover:bg-white transition-colors">
                    <Terminal size={20} /> Initialize Protocol
                  </a>
                  <a href="#sign" onClick={(e) => { e.preventDefault(); notifyEvent('cta_review_sign_click', {}, { interactive: true }); window.dispatchEvent(new CustomEvent('open-manifesto-gate')); }} className="group border border-neon text-neon px-8 py-4 font-bold text-lg uppercase tracking-wide flex items-center gap-2 hover:bg-neon hover:text-black transition-colors">
                    <ShieldAlert size={20} /> Review & Sign
                  </a>
                  <div className="border border-gray-700 px-8 py-4 flex items-center gap-4 bg-black/50 backdrop-blur-sm">
                    <div className="text-right">
                      <div className="text-xs text-gray-500 uppercase mono">Presented By</div>
                      <div className="font-bold text-white">CASEY LARKIN</div>
                    </div>
                    <div className="h-10 w-10 bg-gray-800 rounded-full flex items-center justify-center font-bold text-neon border border-neon">CL</div>
                  </div>
                </div>
              </div>

              <div className="absolute bottom-10 right-10 hidden md:block">
                <div className="mono text-xs text-gray-600 text-right">
                  <p>STATUS: OPERATIONAL</p>
                  <p>LATENCY: 12ms</p>
                  <p>ENCRYPTION: AES-256</p>
                  <p className="text-neon animate-pulse">SINGULARITY DETECTED</p>
                </div>
              </div>
            </section>
          );
        };

        // The Problem Component
        const TheProblem = () => {
          return (
            <section className="py-20 px-6 md:px-20 bg-gray-900/30 border-y border-gray-800">
              <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div>
                  <SectionHeader number="01" title="Visibility Is Dead" subtitle="The Legacy Narrative Collapse" />
                  <p className="text-lg text-gray-400 mb-6">
                    The industry is drowning in "Control Towers" that are really just observation decks for chaos.
                    Visibility is passive. It's watching a disaster happen in real-time.
                  </p>
                  <p className="text-lg text-gray-400 mb-8">
                    <strong className="text-white">Sensos is the divergence point.</strong> We aren't selling a window to look through.
                    We are selling a brain that acts.
                  </p>
                  <ul className="space-y-4 mono text-sm">
                    <li className="flex items-center gap-3 text-red-500 line-through decoration-red-500/50">
                      <ShieldAlert size={16} /> "See where your shipment is."
                    </li>
                    <li className="flex items-center gap-3 text-neon">
                      <Zap size={16} /> "Shipment Resolved."
                    </li>
                  </ul>
                </div>
                <div className="relative h-96 bg-black border border-gray-800 p-4 rounded-lg overflow-hidden group">
                  {/* Fake HUD UI */}
                  <div className="absolute top-4 left-4 flex gap-2">
                    <div className="w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                    <span className="mono text-xs text-red-500">CRITICAL ANOMALY DETECTED</span>
                  </div>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="w-64 h-64 border border-gray-800 rounded-full flex items-center justify-center relative animate-[spin_10s_linear_infinite]">
                      <div className="w-48 h-48 border border-dashed border-gray-700 rounded-full"></div>
                      <div className="absolute top-0 w-2 h-10 bg-gray-800"></div>
                    </div>
                    <div className="absolute z-10 text-center">
                      <h3 className="text-3xl font-black text-white mb-1">LIA</h3>
                      <p className="mono text-neon text-xs">PROCESSING...</p>
                    </div>
                  </div>
                  {/* Code Rain Overlay */}
                  <div className="absolute bottom-4 left-4 mono text-xs text-gray-600 opacity-50">
                    {`> INITIATING HEALING PROTOCOL...`} <br/>
                    {`> REROUTING VIA FRA...`} <br/>
                    {`> CARRIER NOTIFIED...`} <br/>
                    {`> EXCEPTION CLEARED.`}
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Voice Engine Component
        const VoiceEngine = () => {
          const [isSpeaking, setIsSpeaking] = useState(false);
          const [loading, setLoading] = useState(false);
          const [statusText, setStatusText] = useState("SYSTEM READY. WAITING FOR INPUT.");
          
          const activateVoice = async () => {
            if (loading || isSpeaking) return;
            setLoading(true);
            setStatusText("ANALYZING NETWORK FOR ANOMALIES...");

            // 1. Generate a Crisis Scenario Script
            const script = await generateText("Generate a very short, urgent, 2-sentence executive summary of a critical supply chain disruption (e.g. 'Temperature excursion detected in Dubai, shipment 404'). Use military/AI jargon. End with 'Rerouting Initiated.'");
            
            if (script && script !== "System Error." && script !== "Connection Lost.") {
              setStatusText(script.toUpperCase());
              
              // 2. Generate Audio
              const audioData = await generateSpeech(script);
              
              if (audioData) {
                setLoading(false);
                setIsSpeaking(true);
                const wavBlob = base64ToWav(audioData);
                const audioUrl = URL.createObjectURL(wavBlob);
                const audio = new Audio(audioUrl);
                
                audio.onended = () => {
                  setIsSpeaking(false);
                  setStatusText("TRANSMISSION COMPLETE.");
                };
                
                audio.play();
              } else {
                setLoading(false);
                setStatusText("AUDIO SYNTHESIS FAILED.");
              }
            } else {
              setLoading(false);
              setStatusText("DATA STREAM INTERRUPTED.");
            }
          };

          return (
            <div className="mt-12 p-8 bg-black border border-gray-800 rounded-xl relative overflow-hidden group hover:border-neon transition-colors">
              <div className="absolute top-0 right-0 p-3 bg-gray-900 border-l border-b border-gray-800">
                <span className="mono text-xs text-neon flex items-center gap-2">
                  <Brain size={12} /> BRAIN VOICE ENGINE v2.0
                </span>
              </div>
              
              <div className="flex flex-col md:flex-row gap-8 items-center">
                <div className="flex-1">
                  <h3 className="text-2xl font-bold mb-2">LIA DOESN'T JUST TEXT. <br/><span className="text-neon">SHE SPEAKS.</span></h3>
                  <p className="text-gray-400 text-sm mb-6">
                    Executives don't read dashboards. They listen to briefings. 
                    The <strong className="text-white">Brain Voice Engine</strong> synthesizes complex logistics data into 
                    executive summaries instantly.
                  </p>
                  <button 
                    onClick={activateVoice}
                    disabled={loading || isSpeaking}
                    className={`flex items-center gap-3 px-6 py-3 rounded font-bold mono uppercase transition-all ${isSpeaking ? 'bg-red-500 text-white animate-pulse' : 'bg-gray-800 text-white hover:bg-neon hover:text-black'}`}
                  >
                    {loading ? <><Loader size={18} className="animate-spin" /> Synthesizing...</> : 
                     isSpeaking ? <><Activity size={18} /> Transmitting...</> : 
                     <><Sparkles size={18} /> Initialize Voice Protocol ✨</>}
                  </button>
                </div>

                <div className="w-full md:w-64 h-24 bg-gray-900 rounded flex items-center justify-center gap-1 px-4 overflow-hidden border border-gray-700">
                  {[...Array(20)].map((_, i) => (
                    <div 
                      key={i} 
                      className={`w-2 bg-neon rounded-full bar ${isSpeaking ? '' : 'h-1 opacity-20'}`}
                      style={{
                        height: isSpeaking ? `${Math.random() * 100}%` : '4px',
                        animationDuration: `${Math.random() * 400 + 100}ms`,
                        animationPlayState: isSpeaking ? 'running' : 'paused'
                      }}
                    ></div>
                  ))}
                </div>
              </div>
              
              <div className="absolute bottom-4 left-8 mono text-xs text-neon max-w-2xl truncate">
                {statusText}
              </div>
            </div>
          );
        };

        // Meme Generator Component
        const MemeGenerator = () => {
          const [scenario, setScenario] = useState("");
          const [textTop, setTextTop] = useState("WHEN THE BROKER SAYS");
          const [textBottom, setTextBottom] = useState("IT'S 'JUST AROUND THE CORNER'");
          const [bgImage, setBgImage] = useState(null);
          const [loading, setLoading] = useState(false);

          const generateMeme = async () => {
            if (!scenario) return;
            setLoading(true);
            
            // 1. Generate Text - UPDATED PROMPT FOR SHORTER TEXT (AGAIN)
            // Reduce max words to 5 to force brevity.
            const prompt = `Write a super short, punchy meme caption (Top Text and Bottom Text, MAX 5 WORDS EACH) for this supply chain scenario: '${scenario}'. Return ONLY valid JSON in this format: { "top": "TEXT", "bottom": "TEXT" }`;
            const textResult = await generateText(prompt);
            
            // Parse JSON safely
            try {
              // Clean up markdown block if present
              const cleanedJson = textResult.replace(/```json/g, '').replace(/```/g, '');
              const parsed = JSON.parse(cleanedJson);
              setTextTop(parsed.top?.toUpperCase() || "ERROR");
              setTextBottom(parsed.bottom?.toUpperCase() || "RETRY");
            } catch (e) {
              console.log("JSON Parse Error", e);
              setTextTop("SYSTEM");
              setTextBottom("OVERLOAD");
            }

            // 2. Generate Image
            const imgUrl = await generateImage(scenario);
            if (imgUrl) setBgImage(imgUrl);
            
            setLoading(false);
          };

          return (
            <div className="mt-16 bg-zinc-900 border border-gray-700 p-1">
              <div className="bg-black p-6 border-b border-gray-800 flex justify-between items-center">
                <h3 className="font-bold text-xl uppercase flex items-center gap-2">
                  <ImageIcon size={20} className="text-neon" /> 
                  The Culture Weapon
                </h3>
                <span className="mono text-xs text-gray-500">POWERED BY GEMINI + IMAGEN 3</span>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2">
                {/* Controls */}
                <div className="p-8 border-r border-gray-800">
                  <p className="text-gray-400 text-sm mb-6">
                    We don't just win on tech. We win on <span className="text-white">narrative</span>. 
                    Enter a scenario, and the AI generates the content to dominate the feed.
                  </p>
                  
                  <div className="space-y-4">
                    <div>
                      <label className="mono text-xs text-gray-500 block mb-1">TACTICAL SITUATION (SCENARIO)</label>
                      <input 
                        type="text" 
                        value={scenario}
                        onChange={(e) => setScenario(e.target.value)}
                        placeholder="e.g. Driver is late, Customs hold, Cheap broker"
                        className="w-full bg-gray-900 border border-gray-700 p-3 text-white font-bold focus:border-neon outline-none" 
                      />
                    </div>
                    
                    <div className="pt-4 border-t border-gray-800 mt-4 opacity-50 pointer-events-none">
                        <div className="mb-2">
                            <label className="mono text-xs text-gray-500 block mb-1">GENERATED TOP TEXT</label>
                            <div className="w-full bg-gray-900 p-2 text-xs text-gray-400">{textTop}</div>
                        </div>
                        <div>
                            <label className="mono text-xs text-gray-500 block mb-1">GENERATED BOTTOM TEXT</label>
                            <div className="w-full bg-gray-900 p-2 text-xs text-gray-400">{textBottom}</div>
                        </div>
                    </div>

                    <button 
                        onClick={generateMeme}
                        disabled={loading || !scenario}
                        className="mt-8 w-full bg-neon text-black font-bold py-3 flex items-center justify-center gap-2 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        {loading ? <Loader className="animate-spin" size={18}/> : <Sparkles size={18} />} 
                        {loading ? "GENERATING ASSETS..." : "DEPLOY CONTENT WEAPON ✨"}
                    </button>
                  </div>
                </div>

                {/* Preview */}
                <div className="p-8 flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
                  {/* MEME CONTAINER */}
                  <div className="w-full aspect-square relative flex flex-col justify-between overflow-hidden bg-gray-900 border-4 border-white shadow-2xl">
                    
                    {/* Background Image Layer */}
                    <div className="absolute inset-0 z-0">
                        {bgImage ? (
                            <img src={bgImage} alt="AI Generated Background" className="w-full h-full object-cover opacity-80" />
                        ) : (
                            <div className="w-full h-full bg-gradient-to-br from-red-900 to-black opacity-50"></div>
                        )}
                    </div>
                    
                    {/* Gradient Overlays for Readability */}
                    <div className="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-black/80 to-transparent z-10 pointer-events-none"></div>
                    <div className="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-black/80 to-transparent z-10 pointer-events-none"></div>

                    {/* Content Layer */}
                    <div className="relative z-20 w-full h-full flex flex-col justify-between p-6">
                        
                        <h2 className="text-2xl md:text-3xl font-black text-white uppercase font-impact text-center leading-none tracking-wide break-words drop-shadow-xl" 
                            style={{ textShadow: '3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000' }}>
                          {textTop}
                        </h2>
                        
                        {/* Center Icon only if no image */}
                        {!bgImage && (
                             <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-50">
                                <div className="w-24 h-24 bg-black rounded-full border-4 border-neon flex items-center justify-center">
                                    <Zap size={48} className="text-neon" />
                                </div>
                             </div>
                        )}

                        <h2 className="text-2xl md:text-3xl font-black text-white uppercase font-impact text-center leading-none tracking-wide break-words drop-shadow-xl" 
                            style={{ textShadow: '3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000' }}>
                          {textBottom}
                        </h2>
                        
                        <div className="absolute bottom-2 right-2 mono text-[10px] text-white/50 z-30 font-sans tracking-normal font-normal">GENERATED BY SENSOS</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Strategy Component
        const Strategy = () => {
          const pillars = [
            {
              title: "The Void",
              desc: "Vantablack Aesthetic. The unknown depth of the supply chain.",
              color: "border-gray-800",
              icon: <Globe className="text-gray-500" />
            },
            {
              title: "The Pulse",
              desc: "Bio-Electric Cyan. The signal cutting through the noise.",
              color: "border-neon",
              icon: <Activity className="text-neon" />
            },
            {
              title: "The Brain",
              desc: "Agentic AI. LIA doesn't report. She executes.",
              color: "border-white",
              icon: <Brain className="text-white" />
            }
          ];

          return (
            <section className="py-24 px-6 md:px-20 relative">
              <div className="max-w-7xl mx-auto">
                <SectionHeader number="02" title="The Singularity" subtitle="Strategic Master Plan" />
                
                <div className="mb-16 max-w-3xl">
                  <p className="text-xl leading-relaxed text-gray-300">
                    In astrophysics, a singularity is where the old rules of physics break down. 
                    In logistics, it's the moment <span className="text-neon">Sensos LIA</span> collapses 
                    the distance between "Warning" and "Fix".
                  </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                  {pillars.map((p, i) => (
                    <div key={i} className={`bg-gray-900/20 border ${p.color} p-8 hover:bg-gray-900/50 transition-all duration-300 group`}>
                      <div className="mb-6">{p.icon}</div>
                      <h3 className="text-2xl font-bold mb-3 uppercase">{p.title}</h3>
                      <p className="text-gray-400 text-sm mono leading-relaxed">{p.desc}</p>
                    </div>
                  ))}
                </div>

                <VoiceEngine />

              </div>
            </section>
          );
        };

        // Manifest Plan Component
        const ManifestPlan = () => {
          return (
            <section className="py-24 px-6 md:px-20 bg-zinc-900 border-t border-b border-gray-800">
              <div className="max-w-7xl mx-auto">
                <SectionHeader number="03" title="Manifest 2026" subtitle="Operation: Dominance" />
                
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
                  {/* The Booth */}
                  <div className="lg:col-span-8 bg-black border border-gray-800 p-8 relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-2 bg-neon text-black font-bold text-xs mono">BOOTH #337</div>
                    <h3 className="text-3xl font-bold mb-2">THE MONOLITH</h3>
                    <p className="text-gray-400 mb-6 max-w-xl">
                      While competitors build white, friendly booths, we build a black box. 
                      A semi-transparent mesh facade. You hear the hum, you see the glow, 
                      but you have to <em className="text-white">enter</em> to see the tech.
                    </p>
                    <div className="grid grid-cols-2 gap-4 mt-8">
                      <div className="bg-gray-900 p-4 border-l-2 border-neon">
                        <h4 className="text-neon font-bold mono text-sm mb-1">INTERIOR</h4>
                        <p className="text-xs text-gray-500">The "LIA Pillar" hologram core. Real-time neural viz.</p>
                      </div>
                      <div className="bg-gray-900 p-4 border-l-2 border-neon">
                        <h4 className="text-neon font-bold mono text-sm mb-1">EXTERIOR</h4>
                        <p className="text-xs text-gray-500">Sleek mesh. The "Velvet Rope" strategy.</p>
                      </div>
                    </div>
                  </div>

                  {/* The War Game */}
                  <div className="lg:col-span-4 bg-gray-900 border border-gray-800 p-8 flex flex-col justify-between">
                    <div>
                      <div className="flex items-center gap-2 mb-4 text-alert">
                        <Radio size={20} className="animate-pulse" />
                        <span className="mono font-bold">12:30 PM - ROUNDTABLE</span>
                      </div>
                      <h3 className="text-2xl font-bold mb-4">THE WAR GAME</h3>
                      <p className="text-sm text-gray-400 mb-6">
                        No panels. We hand out "Crisis Cards" (e.g., Pharma Excursion). 
                        Let them fail with their current tools. Then show LIA solving it in seconds.
                      </p>
                    </div>
                    <div className="p-4 bg-black/50 border border-red-900/30 rounded">
                      <p className="mono text-xs text-red-400">"Your shipment is spoiling in Dubai. You are asleep. What now?"</p>
                    </div>
                  </div>

                  {/* Meme Generator */}
                  <div className="lg:col-span-12">
                    <MemeGenerator />
                  </div>

                  {/* The Dinners */}
                  <div className="lg:col-span-12 grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div className="bg-gradient-to-br from-gray-900 to-black p-8 border border-gray-800">
                      <div className="flex justify-between items-start mb-4">
                        <h3 className="text-2xl font-bold text-white">NIGHT 1: THE HAFLA</h3>
                        <span className="mono text-xs bg-gray-800 px-2 py-1 rounded">MIZNON</span>
                      </div>
                      <p className="text-gray-400 text-sm">
                        Chaos. Energy. Arak shots and whole cauliflowers thrown on tables. 
                        We break the ice by being "Freight Famous."
                      </p>
                    </div>
                    <div className="bg-black p-8 border border-gray-800 relative">
                      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-red-900/20 via-black to-black opacity-50"></div>
                      <div className="relative z-10">
                        <div className="flex justify-between items-start mb-4">
                          <h3 className="text-2xl font-bold text-white">NIGHT 2: THE SANCTUARY</h3>
                          <span className="mono text-xs bg-red-900/30 text-red-400 px-2 py-1 rounded">TAO</span>
                        </div>
                        <p className="text-gray-400 text-sm">
                          Silence. Control. The Opium Room. This is where we close the C-Suite 
                          with precise service and absolute confidence.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Pricing Component
        const Pricing = () => {
          return (
            <section id="proposal" className="py-24 px-6 md:px-20 relative overflow-hidden">
              <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
              
              <div className="max-w-6xl mx-auto relative z-10">
                <SectionHeader number="04" title="The Insider Advantage" subtitle="All Muscle. No Fat." />

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                  <div className="lg:col-span-2">
                    <p className="text-lg text-gray-300 mb-6">
                      You can hire an agency and pay for their office snacks, or you can hire 
                      <span className="text-neon font-bold"> Dude, What's The Bid?!</span>. 
                      Same strategy. Same "Singularity" vision. 
                      <br/><span className="text-white font-bold bg-green-900/20 px-1">Half the cost.</span>
                    </p>
                  </div>
                </div>

                {/* Comparison Table */}
                <div className="overflow-x-auto">
                  <table className="w-full text-left border-collapse">
                    <thead>
                      <tr className="border-b-2 border-gray-700 text-sm uppercase text-gray-500 mono">
                        <th className="py-4 px-4">Deliverable</th>
                        <th className="py-4 px-4 text-red-400 opacity-70">Agency Price</th>
                        <th className="py-4 px-4 text-neon">The "Dude" Price</th>
                        <th className="py-4 px-4 hidden md:table-cell">The Reality</th>
                      </tr>
                    </thead>
                    <tbody className="text-gray-300 divide-y divide-gray-800">
                      <tr className="hover:bg-white/5 transition-colors">
                        <td className="py-6 px-4 font-bold">Phase 1: Rebrand & WebGL Site</td>
                        <td className="py-6 px-4 mono text-red-400 line-through decoration-red-500/50">$111,500</td>
                        <td className="py-6 px-4 mono text-neon font-bold text-xl">$75,000</td>
                        <td className="py-6 px-4 text-sm text-gray-500 hidden md:table-cell">I use my own dev team. No markup.</td>
                      </tr>
                      <tr className="hover:bg-white/5 transition-colors">
                        <td className="py-6 px-4 font-bold">Phase 2: Manifest Design & Mgmt</td>
                        <td className="py-6 px-4 mono text-red-400 line-through decoration-red-500/50">$58,000</td>
                        <td className="py-6 px-4 mono text-neon font-bold text-xl">$15,000</td>
                        <td className="py-6 px-4 text-sm text-gray-500 hidden md:table-cell">I'm already going. No flight costs charged to you.</td>
                      </tr>
                      <tr className="hover:bg-white/5 transition-colors">
                        <td className="py-6 px-4 font-bold">Phase 3: Monthly Retainer</td>
                        <td className="py-6 px-4 mono text-red-400 line-through decoration-red-500/50">$24,500/mo</td>
                        <td className="py-6 px-4 mono text-neon font-bold text-xl">$12,000/mo</td>
                        <td className="py-6 px-4 text-sm text-gray-500 hidden md:table-cell">Paying for brain, not overhead.</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                {/* Digital Signature Option */}
                <div id="sign" className="mt-12 grid grid-cols-1 lg:grid-cols-2 gap-8">
                  <div className="bg-black border border-gray-800 p-8 rounded-xl">
                    <h3 className="text-2xl font-bold mb-2">Authorize The Proposal</h3>
                    <p className="text-gray-400 text-sm mb-6">Optionally add a digital signature to acknowledge receipt or intent. Your signature is stored locally until you export it.</p>
                    <SignaturePad />
                  </div>
                  <div className="bg-gray-900 border border-gray-800 p-8 rounded-xl">
                    <h4 className="text-neon mono text-xs mb-2">Notes</h4>
                    <ul className="text-sm text-gray-400 space-y-2">
                      <li>Signature is captured as a PNG image (base64).</li>
                      <li>No backend is connected. Use Export to download.</li>
                      <li>Works with mouse and touch. Clear to reset.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Digital Signature Pad Component
        const SignaturePad = () => {
          const canvasRef = useRef(null);
          const previewRef = useRef(null);
          const [enabled, setEnabled] = useState(true);
          const [hasInk, setHasInk] = useState(false);
          const [dataUrl, setDataUrl] = useState("");
          const [drawing, setDrawing] = useState(false);
          const lastRef = useRef({ x: 0, y: 0 });

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';

            const getPos = (evt) => {
              const rect = canvas.getBoundingClientRect();
              const clientX = evt.clientX ?? (evt.touches && evt.touches[0].clientX);
              const clientY = evt.clientY ?? (evt.touches && evt.touches[0].clientY);
              return { x: clientX - rect.left, y: clientY - rect.top };
            };

            const start = (evt) => { evt.preventDefault(); setDrawing(true); lastRef.current = getPos(evt); };
            const move = (evt) => {
              if (!drawing) return; evt.preventDefault();
              const p = getPos(evt);
              ctx.beginPath(); ctx.moveTo(lastRef.current.x, lastRef.current.y); ctx.lineTo(p.x, p.y); ctx.stroke();
              lastRef.current = p; setHasInk(true);
            };
            const end = (evt) => { if (!drawing) return; evt.preventDefault(); setDrawing(false); };

            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('mousemove', move);
            window.addEventListener('mouseup', end);
            canvas.addEventListener('touchstart', start, { passive: false });
            canvas.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('touchend', end, { passive: false });

            const cleanup = () => {
              canvas.removeEventListener('mousedown', start);
              canvas.removeEventListener('mousemove', move);
              window.removeEventListener('mouseup', end);
              canvas.removeEventListener('touchstart', start, { passive: false });
              canvas.removeEventListener('touchmove', move, { passive: false });
              window.removeEventListener('touchend', end, { passive: false });
            };
            return cleanup;
          }, [drawing]);

          useEffect(() => {
            // responsive CSS sizing while keeping internal resolution
            const canvas = canvasRef.current;
            const section = canvas?.parentElement;
            const resize = () => {
              if (!canvas || !section) return;
              const baseW = 640, baseH = 240;
              const maxW = Math.min(baseW, section.clientWidth - 4);
              const scale = maxW / baseW;
              canvas.style.width = `${maxW}px`;
              canvas.style.height = `${baseH * scale}px`;
            };
            window.addEventListener('resize', resize);
            resize();
            return () => window.removeEventListener('resize', resize);
          }, []);

          const clear = () => {
            const canvas = canvasRef.current; if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            setHasInk(false); setDataUrl("");
            if (previewRef.current) previewRef.current.src = "";
          };

          const save = () => {
            const canvas = canvasRef.current; if (!canvas) return;
            if (!hasInk) { alert('Please add a signature before saving.'); return; }
            const url = canvas.toDataURL('image/png');
            setDataUrl(url);
            if (previewRef.current) previewRef.current.src = url;
            notifyEvent('signature_saved', { bytes: url.length });
          };

          const exportPng = () => {
            if (!dataUrl) return;
            const a = document.createElement('a');
            a.href = dataUrl; a.download = 'signature.png';
            a.click();
            notifyEvent('signature_downloaded');
          };

          return (
            <div>
              <label className="flex items-center gap-2 mb-4 cursor-pointer">
                <input type="checkbox" checked={enabled} onChange={() => { setEnabled(v => !v); if (enabled) clear(); }} />
                <span className="mono text-xs text-gray-400">Add Digital Signature</span>
              </label>
              {!enabled ? (
                <div className="text-gray-600 text-sm">Toggle to enable signature pad.</div>
              ) : (
                <div>
                  <canvas ref={canvasRef} width={640} height={240} className="w-full bg-gray-950 border border-gray-800 rounded-lg" aria-label="Signature pad"></canvas>
                  <div className="flex gap-3 mt-3">
                    <button onClick={clear} className="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700">Clear</button>
                    <button onClick={save} className="px-4 py-2 bg-neon text-black font-bold rounded hover:bg-white">Save Signature</button>
                    <button onClick={exportPng} disabled={!dataUrl} className="px-4 py-2 bg-gray-900 text-white border border-gray-700 rounded disabled:opacity-50">Download Signature</button>
                  </div>
                  <div className="mt-4">
                    <div className="mono text-xs text-gray-500 mb-2">Saved signature preview:</div>
                    <img ref={previewRef} alt="Saved signature preview" className="max-w-full h-auto border border-gray-800 rounded" />
                  </div>
                  <input type="hidden" name="signatureData" value={dataUrl} />
                </div>
              )}
            </div>
          );
        };

        const ApiKeyModal = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [key, setKey] = useState("");

            useEffect(() => {
                if (!getApiKey()) {
                    const timer = setTimeout(() => setIsOpen(true), 2000); // Prompt after 2s if missing
                    return () => clearTimeout(timer);
                }
            }, []);

            const saveKey = () => {
                if (key) {
                    localStorage.setItem('gemini_api_key', key);
                    setIsOpen(false);
                    window.location.reload(); // Reload to ensure everything picks it up
                }
            };

            if (!isOpen) return (
                <button onClick={() => setIsOpen(true)} className="fixed bottom-4 left-4 z-50 bg-gray-900 text-gray-500 p-2 rounded-full hover:text-white border border-gray-800">
                    <ShieldAlert size={16} />
                </button>
            );

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">
                    <div className="bg-gray-900 border border-neon p-8 rounded-xl max-w-md w-full shadow-[0_0_50px_rgba(0,255,194,0.2)]">
                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <ShieldAlert className="text-neon" /> SECURITY CLEARANCE
                        </h3>
                        <p className="text-gray-400 text-sm mb-6">
                            This terminal requires a Gemini API Key for neural processing. 
                            The key is stored locally in your browser (localStorage) and never sent to our servers.
                        </p>
                        <input 
                            type="password" 
                            value={key}
                            onChange={(e) => setKey(e.target.value)}
                            placeholder="Paste Gemini API Key"
                            className="w-full bg-black border border-gray-700 p-3 text-white font-mono mb-4 focus:border-neon outline-none"
                        />
                        <div className="flex justify-end gap-4">
                            <button onClick={() => setIsOpen(false)} className="text-gray-500 hover:text-white text-sm">CANCEL</button>
                            <button onClick={saveKey} className="bg-neon text-black font-bold px-6 py-2 hover:bg-white transition-colors">
                                AUTHENTICATE
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        function App() {
          // Notify when signature section enters viewport
          useEffect(() => {
            const el = document.getElementById('sign');
            if (!el) return;
            const obs = new IntersectionObserver((entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  notifyEvent('view_signature_section');
                }
              });
            }, { threshold: 0.5 });
            obs.observe(el);
            return () => obs.disconnect();
          }, []);

          // Heartbeat ping and UI health checks
          useEffect(() => {
            const ping = () => notifyEvent('heartbeat');
            const checkUi = () => {
              const fixed = document.querySelector('.fixed.bottom-0');
              const sign = document.getElementById('sign');
              const canvas = sign?.querySelector('canvas');
              const saveBtn = sign?.querySelector('button:nth-of-type(2)');
              if (!fixed || !sign || !canvas || !saveBtn) {
                notifyEvent('ui_missing', {
                  fixed: !!fixed,
                  sign: !!sign,
                  canvas: !!canvas,
                  saveBtn: !!saveBtn,
                });
              }
            };
            // initial and interval
            ping();
            checkUi();
            const pingId = setInterval(ping, 60 * 1000); // every 1 min
            const checkId = setInterval(checkUi, 60 * 1000);
            return () => { clearInterval(pingId); clearInterval(checkId); };
          }, []);
          // Notify when webhook configured
          useEffect(() => {
            const url = getNotifyUrl();
            if (url) {
              notifyEvent('notify_connected');
            }
          }, []);
          return (
            <div className="bg-black text-white min-h-screen">
              <style>{styles}</style>
              <div className="scanline"></div>
              <ApiKeyModal />
              <Hero />
              <TheProblem />
              <Strategy />
              <ManifestPlan />
              <Pricing />
              <FixedCTA />
              <NotifyModal />
              <ManifestoGate />
              <ToastHost />
              <ReviewSignPortal />
            </div>
          );
        }

        // Notifications configuration modal
        const NotifyModal = () => {
          const [open, setOpen] = useState(false);
          const [url, setUrl] = useState("");
          const [connected, setConnected] = useState(!!getNotifyUrl());

          useEffect(() => {
            setUrl(getNotifyUrl() || "");
          }, []);

          const save = () => {
            if (url) {
              localStorage.setItem('notify_url', url);
              setConnected(true);
              window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Webhook connected.' } }));
              notifyEvent('notify_saved', { url });
              setOpen(false);
            }
          };

          const test = () => {
            notifyEvent('notify_test', { example: 'hello' }, { interactive: true });
          };

          return (
            <>
              <button onClick={() => setOpen(true)} className="fixed bottom-16 left-4 z-50 bg-gray-900 text-gray-500 px-3 py-2 rounded-full hover:text-white border border-gray-800">
                {connected ? 'Notifications: On' : 'Notifications: Off'}
              </button>
              {!open ? null : (
                <div className="fixed inset-0 z-[130] flex items-center justify-center bg-black/80 backdrop-blur-sm">
                  <div className="bg-gray-900 border border-neon p-6 rounded-xl w-full max-w-md">
                    <h3 className="text-white font-bold mb-3">Notifications Webhook</h3>
                    <p className="text-gray-400 text-sm mb-4">Paste a webhook URL (e.g., webhook.site). Events will be sent silently.</p>
                    <input value={url} onChange={(e) => setUrl(e.target.value)} placeholder="https://..." className="w-full bg-black border border-gray-700 p-2 text-white" />
                    <div className="flex justify-end gap-2 mt-4">
                      <button onClick={() => setOpen(false)} className="text-gray-400">Cancel</button>
                      <button onClick={test} className="px-3 py-1 bg-gray-800 text-white">Send Test</button>
                      <button onClick={save} className="px-3 py-1 bg-neon text-black font-bold">Save</button>
                    </div>
                  </div>
                </div>
              )}
            </>
          );
        };

        // Manifesto Gate (modal)
        const ManifestoGate = () => {
          const [open, setOpen] = useState(false);
          const docId = '1r6HGpR1DKIcxUtr-xyyLTzuDrhqIhaIQ';
          const docUrl = `https://drive.google.com/file/d/${docId}/preview`;
          useEffect(() => {
            const handler = () => setOpen(true);
            window.addEventListener('open-manifesto-gate', handler);
            return () => window.removeEventListener('open-manifesto-gate', handler);
          }, []);
          if (!open) return null;
          const continueFlow = () => {
            setOpen(false);
            notifyEvent('manifesto_reviewed', {}, { interactive: true });
            window.dispatchEvent(new CustomEvent('open-real-review-sign-portal'));
          };
          return (
            <div className="fixed inset-0 z-[120] bg-black/85 backdrop-blur-sm flex items-center justify-center p-4">
              <div className="bg-gray-950 border border-neon w-full max-w-5xl">
                <div className="flex items-center justify-between p-4 border-b border-gray-800">
                  <h3 className="text-white font-bold uppercase">The Plan / Manifesto</h3>
                  <button onClick={() => setOpen(false)} className="text-gray-400 hover:text-white text-xs">Close</button>
                </div>
                <div className="p-4">
                  <div className="h-[70vh] relative bg-black border border-neon shadow-[0_0_30px_rgba(0,255,194,0.15)] overflow-hidden">
                    <div className="absolute inset-0 pointer-events-none opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                    <iframe title="Manifesto" src={docUrl} className="w-full h-full grayscale-[10%] contrast-110"/>
                    <div className="absolute inset-x-0 top-0 h-16 bg-gradient-to-b from-black/80 to-transparent"></div>
                    <div className="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-black/80 to-transparent"></div>
                  </div>
                  <div className="flex justify-between items-center mt-4">
                    <span className="mono text-xs text-neon">Step 1 of 2: Review the manifesto</span>
                    <button onClick={continueFlow} className="px-4 py-2 bg-neon text-black font-bold rounded hover:bg-white">Continue to Review & Sign</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Simple toast host
        const ToastHost = () => {
          const [msg, setMsg] = useState("");
          useEffect(() => {
            const handler = (e) => {
              setMsg(e.detail?.message || "");
              clearTimeout(window.__toastTimer);
              window.__toastTimer = setTimeout(() => setMsg(""), 2500);
            };
            window.addEventListener('toast', handler);
            return () => window.removeEventListener('toast', handler);
          }, []);
          if (!msg) return null;
          return (
            <div className="fixed bottom-6 right-6 z-[200]">
              <div className="px-4 py-2 bg-black/80 text-white border border-neon shadow-[0_0_20px_rgba(0,255,194,0.2)] rounded mono text-xs">
                {msg}
              </div>
            </div>
          );
        };

        // Review & Sign Portal (modal)
        const ReviewSignPortal = () => {
          const [open, setOpen] = React.useState(false);
          const nameRef = useRef(null);
          const titleRef = useRef(null);
          const emailRef = useRef(null);
          const companyRef = useRef(null);
          const canvasRef = useRef(null);
          const [hasInk, setHasInk] = useState(false);
          const [pdfBlob, setPdfBlob] = useState(null);
          const [canSend, setCanSend] = useState(false);
          const docId = '1xruZfOiLhtGaJRXBsfyowWob0Hn808oy';
          const docUrl = `https://docs.google.com/document/d/${docId}/preview`;
          const pdfUrl = `https://docs.google.com/document/d/${docId}/export?format=pdf`;

          useEffect(() => {
            const openHandler = () => setOpen(true);
            window.addEventListener('open-real-review-sign-portal', openHandler);
            return () => window.removeEventListener('open-real-review-sign-portal', openHandler);
          }, []);

          useEffect(() => {
            if (!open) return;
            // init signature pad handlers
            const canvas = canvasRef.current; if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2; ctx.lineJoin = 'round'; ctx.lineCap = 'round';
            let drawing = false; let last = { x:0, y:0 };
            const getPos = (evt) => {
              const rect = canvas.getBoundingClientRect();
              const cx = evt.clientX ?? (evt.touches && evt.touches[0].clientX);
              const cy = evt.clientY ?? (evt.touches && evt.touches[0].clientY);
              return { x: cx - rect.left, y: cy - rect.top };
            };
            const start = (e) => { e.preventDefault(); drawing = true; last = getPos(e); };
            const move = (e) => { if (!drawing) return; e.preventDefault(); const p = getPos(e); ctx.beginPath(); ctx.moveTo(last.x, last.y); ctx.lineTo(p.x, p.y); ctx.stroke(); last=p; setHasInk(true); };
            const end = (e) => { if (!drawing) return; e.preventDefault(); drawing=false; };
            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('mousemove', move);
            window.addEventListener('mouseup', end);
            canvas.addEventListener('touchstart', start, { passive:false });
            canvas.addEventListener('touchmove', move, { passive:false });
            window.addEventListener('touchend', end, { passive:false });
            // responsive display size
            const resize = () => {
              const baseW=640, baseH=200; const maxW = Math.min(baseW, (canvas.parentElement?.clientWidth || baseW)-4); const scale = maxW/baseW; canvas.style.width = `${maxW}px`; canvas.style.height = `${baseH*scale}px`;
            };
            window.addEventListener('resize', resize); resize();
            return () => {
              canvas.removeEventListener('mousedown', start);
              canvas.removeEventListener('mousemove', move);
              window.removeEventListener('mouseup', end);
              canvas.removeEventListener('touchstart', start, { passive:false });
              canvas.removeEventListener('touchmove', move, { passive:false });
              window.removeEventListener('touchend', end, { passive:false });
              window.removeEventListener('resize', resize);
            }
          }, [open]);

          const clearSig = () => {
            const c = canvasRef.current; if (!c) return; const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); setHasInk(false);
          };

          const submit = async () => {
            const name = nameRef.current?.value?.trim();
            const title = titleRef.current?.value?.trim();
            const email = emailRef.current?.value?.trim();
            const company = companyRef.current?.value?.trim();
            const agree = document.getElementById('agreeTerms')?.checked;
            if (!name || !email || !agree) { alert('Please complete Name, Email, and accept the agreement.'); return; }
            if (!hasInk) { alert('Please add your signature.'); return; }
            const dataUrl = canvasRef.current.toDataURL('image/png');
            await notifyEvent('sow_signed', { name, title, email, company, signatureBytes: dataUrl.length, docId, docUrl }, { interactive: true });
            // Success toast
            window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Signed & sent. Check your email for confirmation.' } }));
            // Generate simple PDF with jsPDF
            try {
              const { jsPDF } = window.jspdf || {};
              if (jsPDF) {
                const doc = new jsPDF({ unit: 'pt', format: 'a4' });
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(14);
                doc.text('Sensos — Statement of Work Acknowledgment', 40, 50);
                doc.setFontSize(11);
                doc.text(`Name: ${name}`, 40, 80);
                doc.text(`Title: ${title || '-'}`, 40, 100);
                doc.text(`Email: ${email}`, 40, 120);
                doc.text(`Company: ${company || '-'}`, 40, 140);
                doc.text(`Date: ${new Date().toLocaleString()}`, 40, 160);
                doc.text(`SOW: ${docUrl}`, 40, 180, { maxWidth: 515 });
                // Signature image
                const imgProps = { x: 40, y: 220, w: 300, h: 100 };
                doc.text('Signature:', 40, 210);
                doc.addImage(dataUrl, 'PNG', imgProps.x, imgProps.y, imgProps.w, imgProps.h);
                doc.save('signed-agreement.pdf');
                const blob = doc.output('blob');
                setPdfBlob(blob);
                setCanSend(true);
              } else {
                console.warn('jsPDF not available');
              }
            } catch (e) {
              console.warn('PDF generation failed', e);
            }
            // Keep portal open so user can send email or close manually
          };

          const sendPdfEmail = async () => {
            if (!pdfBlob) return;
            const name = nameRef.current?.value?.trim();
            const email = emailRef.current?.value?.trim();
            const file = new File([pdfBlob], 'signed-agreement.pdf', { type: 'application/pdf' });
            try {
              if (navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({ files: [file], title: 'Signed Agreement', text: `Signed SOW attached.\nDoc: ${docUrl}` });
                window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Shared via system share.' } }));
                return;
              }
            } catch (e) {
              console.warn('System share failed', e);
            }
            const subject = encodeURIComponent('Signed Agreement — Sensos');
            const bodyText = `Signed SOW attached.\n\nIf attachment did not auto-attach, please attach the downloaded PDF:\n- File: signed-agreement.pdf\n\nDoc Reference: ${docUrl}\nSigner: ${name} (${email})`;
            const body = encodeURIComponent(bodyText);
            window.location.href = `mailto:caseyglarkin2@gmail.com?subject=${subject}&body=${body}`;
          };

          if (!open) return null;
          return (
            <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
              <div className="bg-gray-950 border border-neon w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-0">
                <div className="lg:col-span-8 p-4 border-r border-gray-800">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-white font-bold">Statement of Work — Review</h3>
                    <div className="flex items-center gap-2">
                      <a href={pdfUrl} target="_blank" rel="noreferrer" className="text-neon text-xs underline">Open PDF</a>
                      <button onClick={() => setOpen(false)} className="text-gray-400 hover:text-white text-xs">Close</button>
                    </div>
                  </div>
                  <div className="h-[60vh] lg:h-[70vh] relative bg-black border border-neon shadow-[0_0_30px_rgba(0,255,194,0.15)] overflow-hidden">
                    <div className="absolute inset-0 pointer-events-none opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                    <iframe title="SOW" src={docUrl} className="w-full h-full grayscale-[20%] contrast-125"/>
                    <div className="absolute inset-x-0 top-0 h-16 bg-gradient-to-b from-black/80 to-transparent"></div>
                    <div className="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-black/80 to-transparent"></div>
                  </div>
                </div>
                <div className="lg:col-span-4 p-4">
                  <div className="mb-4">
                    <div className="mono text-neon text-xs mb-2">Order of Operations</div>
                    <ol className="text-gray-300 text-sm space-y-1 list-decimal list-inside">
                      <li>Review the SOW on the left</li>
                      <li>Enter your details</li>
                      <li>Sign in the box</li>
                      <li>Check “I agree”</li>
                      <li>Click “Sign & Send”</li>
                    </ol>
                  </div>
                  <div className="space-y-2">
                    <input ref={nameRef} placeholder="Full Name" className="w-full bg-black border border-gray-800 p-2 text-white"/>
                    <input ref={titleRef} placeholder="Title (optional)" className="w-full bg-black border border-gray-800 p-2 text-white"/>
                    <input ref={emailRef} placeholder="Email" type="email" className="w-full bg-black border border-gray-800 p-2 text-white"/>
                    <input ref={companyRef} placeholder="Company (optional)" className="w-full bg-black border border-gray-800 p-2 text-white"/>
                  </div>
                  <div className="mt-3">
                    <div className="mono text-xs text-gray-400 mb-1">Signature</div>
                    <canvas ref={canvasRef} width={640} height={200} className="w-full bg-gray-950 border border-gray-800 rounded" aria-label="Signature pad"></canvas>
                    <div className="flex gap-2 mt-2">
                      <button onClick={clearSig} className="px-3 py-1 bg-gray-800 text-white text-sm">Clear</button>
                    </div>
                  </div>
                  <label className="flex items-center gap-2 mt-3 text-sm text-gray-300">
                    <input id="agreeTerms" type="checkbox"/> I agree to the terms in this SOW.
                  </label>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2 mt-4">
                    <button onClick={submit} className="w-full bg-neon text-black font-bold py-2">Sign & Send</button>
                    <button onClick={sendPdfEmail} disabled={!canSend} className="w-full bg-gray-900 text-white border border-gray-700 rounded disabled:opacity-50">Send Signed PDF by Email</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Fixed bottom CTA
        const FixedCTA = () => {
          const handleClick = (e) => {
            e.preventDefault();
            notifyEvent('cta_fixed_review_sign_click', {}, { interactive: true });
            window.dispatchEvent(new CustomEvent('open-manifesto-gate'));
          };
          return (
            <div className="fixed bottom-0 left-0 right-0 z-40">
              <div className="mx-4 mb-4 bg-black/70 backdrop-blur-sm border border-neon px-4 py-3 flex items-center justify-between">
                <span className="mono text-xs text-neon">Ready to Review & Sign?</span>
                <button onClick={handleClick} className="px-4 py-2 bg-neon text-black font-bold rounded hover:bg-white">Review & Sign</button>
              </div>
            </div>
          );
        };

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (error) {
            console.error("Render Error:", error);
            document.getElementById('debug-error').style.display = 'block';
            document.getElementById('debug-error').innerHTML += `<strong>Render Error:</strong> ${error.message}<br>`;
        }
    </script>
</body>
</html>