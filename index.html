<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensos Web Proposal v2</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#00FFC2">
    <meta name="description" content="Step 1: See the plan. Step 2: Review & sign. ~2 min total.">
    <meta property="og:title" content="Sensos ‚Äî Plan + SOW Review">
    <meta property="og:description" content="Step 1: See the plan. Step 2: Review & sign. ~2 min total.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <div id="root" class="bg-black min-h-screen text-white flex items-center justify-center">
        <div class="text-center">
            <div class="text-neon text-2xl mb-4 animate-pulse">INITIALIZING SENSOS CORE...</div>
            <div class="text-gray-500 text-sm">Loading Neural Interface</div>
        </div>
    </div>
    <div id="debug-error" style="color: red; padding: 20px; display: none; background: white; position: fixed; top: 0; left: 0; z-index: 9999;"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const debugDiv = document.getElementById('debug-error');
            debugDiv.style.display = 'block';
            debugDiv.innerHTML += `<strong>Error:</strong> ${message}<br>at ${source}:${lineno}<br>`;
        };
    </script>

    <script type="text/babel">
        // --- SAFETY CHECK ---
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            throw new Error("React or ReactDOM failed to load. Please check your internet connection or CDN status.");
        }

        const { useState, useEffect, useRef } = React;
        
        // --- INLINE ICONS (No External Dependencies) ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Terminal = (props) => <Icon {...props}><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></Icon>;
        const Cpu = (props) => <Icon {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></Icon>;
        const ShieldAlert = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const Globe = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></Icon>;
        const DollarSign = (props) => <Icon {...props}><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>;
        const Crosshair = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const MapPin = (props) => <Icon {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const Server = (props) => <Icon {...props}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></Icon>;
        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></Icon>;
        const Brain = (props) => <Icon {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></Icon>;
        const Radio = (props) => <Icon {...props}><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></Icon>;
        const Mic = (props) => <Icon {...props}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></Icon>;
        const Volume2 = (props) => <Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></Icon>;
        const Share2 = (props) => <Icon {...props}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>;
        const ImageIcon = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></Icon>;
        const Loader = (props) => <Icon {...props}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></Icon>;

        // --- GEMINI API HELPERS ---
        
        // Embedded key for seamless demo experience (limited audience)
        const EMBEDDED_API_KEY = 'AIzaSyAcB51zF4gT-Vy7zKxb0sOJkPvyOEj1JLM';
        
        function getApiKey() {
            // Check URL first
            const urlParams = new URLSearchParams(window.location.search);
            const keyFromUrl = urlParams.get('key');
            if (keyFromUrl) {
                localStorage.setItem('gemini_api_key', keyFromUrl);
                window.history.replaceState({}, document.title, window.location.pathname);
                return keyFromUrl;
            }
            // Check localStorage
            const stored = localStorage.getItem('gemini_api_key');
            if (stored) return stored;
            // Fallback to embedded key
            return EMBEDDED_API_KEY;
        }

        // --- EMAILJS INITIALIZATION ---
        // Public key for Sensos proposal (read-only, can only send to configured templates)
        const EMAILJS_PUBLIC_KEY = 'YOUR_EMAILJS_PUBLIC_KEY'; // Replace after setup
        const EMAILJS_SERVICE_ID = 'service_sensos';
        const EMAILJS_TEMPLATE_ID = 'template_sow_signed';
        
        // Initialize EmailJS (will use fallback if not configured)
        if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== 'YOUR_EMAILJS_PUBLIC_KEY') {
          emailjs.init(EMAILJS_PUBLIC_KEY);
        }

        // --- DOCUMENT INTEGRITY ---
        // Hash of the official SOW document to verify it wasn't altered
        const SOW_DOC_ID = '1xruZfOiLhtGaJRXBsfyowWob0Hn808oy';
        const SOW_VERSION = '2025-12-13-v1'; // Update if SOW changes
        
        // Simple hash function for integrity verification
        async function hashString(str) {
          const encoder = new TextEncoder();
          const data = encoder.encode(str);
          const hashBuffer = await crypto.subtle.digest('SHA-256', data);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Send signed agreement via email (to both Casey and signer)
        async function sendSignedAgreement({ name, email, title, company, signedAt, signatureDataUrl, pdfBase64 }) {
          const integrityHash = await hashString(`${SOW_DOC_ID}|${SOW_VERSION}|${name}|${email}|${signedAt}`);
          
          // Always send via webhook (Zapier can forward to email)
          const webhookPayload = {
            event: 'sow_signed_full',
            signer: { name, email, title, company },
            signedAt,
            sowDocId: SOW_DOC_ID,
            sowVersion: SOW_VERSION,
            integrityHash,
            signaturePreview: signatureDataUrl.substring(0, 100) + '...', // Preview only
            pdfBase64: pdfBase64, // Full PDF for attachment
          };
          
          try {
            const webhookUrl = getNotifyUrl();
            await fetch(webhookUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(webhookPayload),
              keepalive: true,
            });
          } catch (e) {
            console.warn('Webhook delivery failed:', e);
          }

          // Also try EmailJS if configured
          if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== 'YOUR_EMAILJS_PUBLIC_KEY') {
            try {
              await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                to_name: 'Casey Larkin',
                to_email: 'caseyglarkin2@gmail.com',
                signer_name: name,
                signer_email: email,
                signer_title: title || 'N/A',
                signer_company: company || 'N/A',
                signed_at: signedAt,
                integrity_hash: integrityHash,
                sow_version: SOW_VERSION,
              });
              // Send copy to signer
              await emailjs.send(EMAILJS_SERVICE_ID, 'template_sow_confirmation', {
                to_name: name,
                to_email: email,
                signed_at: signedAt,
                integrity_hash: integrityHash,
              });
            } catch (e) {
              console.warn('EmailJS delivery failed:', e);
            }
          }
          
          return { integrityHash, success: true };
        }

        async function generateText(prompt) {
          const apiKey = getApiKey();
          if (!apiKey) return "MISSING_KEY";
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: prompt }] }],
                }),
              }
            );
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "System Error.";
          } catch (error) {
            console.error("Text Gen Error:", error);
            return "Connection Lost.";
          }
        }

        async function generateImage(prompt) {
          const apiKey = getApiKey();
          if (!apiKey) return null;
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  instances: [{ prompt: prompt + " in a dark, gritty, cyberpunk logistics aesthetic, high contrast, neon accents, photorealistic, cinematic lighting" }],
                  parameters: { sampleCount: 1 }
                }),
              }
            );
            const data = await response.json();
            if (data.predictions && data.predictions[0] && data.predictions[0].bytesBase64Encoded) {
              return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
            }
            return null;
          } catch (error) {
            console.error("Image Gen Error:", error);
            return null;
          }
        }

        async function generateSpeech(text) {
          const apiKey = getApiKey();
          if (!apiKey) return null;
          try {
            const response = await fetch(
              `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: text }] }],
                  generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                      voiceConfig: {
                        prebuiltVoiceConfig: { voiceName: "Kore" } // Kore sounds authoritative/AI-like
                      }
                    }
                  }
                }),
              }
            );
            const data = await response.json();
            const audioContent = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
            if (audioContent) {
              return audioContent;
            }
            return null;
          } catch (error) {
            console.error("TTS Error:", error);
            return null;
          }
        }

        // --- UTILS ---
        // Helper to decode PCM16 audio (Gemini TTS format) to WAV for browser playback
        function base64ToWav(base64PCM) {
            const binaryString = window.atob(base64PCM);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            // PCM data is raw samples. To play in browser, we wrap in WAV container.
            // 24000Hz is standard for this model usually, mono.
            const sampleRate = 24000;
            const numChannels = 1;
            const bitsPerSample = 16;
            const blockAlign = numChannels * bitsPerSample / 8;
            const byteRate = sampleRate * blockAlign;
            const dataSize = bytes.length;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            // RIFF identifier
            writeString(view, 0, 'RIFF');
            // file length
            view.setUint32(4, 36 + dataSize, true);
            // RIFF type
            writeString(view, 8, 'WAVE');
            // format chunk identifier
            writeString(view, 12, 'fmt ');
            // format chunk length
            view.setUint32(16, 16, true);
            // sample format (raw)
            view.setUint16(20, 1, true);
            // channel count
            view.setUint16(22, numChannels, true);
            // sample rate
            view.setUint32(24, sampleRate, true);
            // byte rate (sample rate * block align)
            view.setUint32(28, byteRate, true);
            // block align (channel count * bytes per sample)
            view.setUint16(32, blockAlign, true);
            // bits per sample
            view.setUint16(34, bitsPerSample, true);
            // data chunk identifier
            writeString(view, 36, 'data');
            // data chunk length
            view.setUint32(40, dataSize, true);

            // Write the PCM samples
            const pcmData = new Uint8Array(buffer, 44);
            pcmData.set(bytes);

            return new Blob([buffer], { type: 'audio/wav' });
        }

        // --- NOTIFICATIONS (Webhook-based) ---
        function getNotifyUrl() {
          const urlParams = new URLSearchParams(window.location.search);
          const fromUrl = urlParams.get('notify');
          if (fromUrl) {
            localStorage.setItem('notify_url', fromUrl);
            // Clean URL of the notify param
            urlParams.delete('notify');
            const newSearch = urlParams.toString();
            const newUrl = window.location.pathname + (newSearch ? `?${newSearch}` : '') + window.location.hash;
            window.history.replaceState({}, document.title, newUrl);
          }
          const saved = localStorage.getItem('notify_url');
          if (saved) return saved;
          // Prefill with a working, no-setup echo endpoint
          const DEFAULT_NOTIFY = 'https://postman-echo.com/post';
          localStorage.setItem('notify_url', DEFAULT_NOTIFY);
          return DEFAULT_NOTIFY;
        }

        async function notifyEvent(eventName, payload = {}, options = {}) {
          try {
            const url = getNotifyUrl();
            const interactive = !!options.interactive;
            if (!url) {
              // Fallback: open a mailto draft (no setup, no cost)
              const subject = encodeURIComponent(`[Sensos] ${eventName}`);
              const body = encodeURIComponent(JSON.stringify({
                event: eventName,
                at: new Date().toISOString(),
                href: window.location.href,
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                ...payload,
              }, null, 2));
              // Use a short debounce to avoid multiple prompts
              if (interactive && !window.__mailtoDebounce) {
                window.__mailtoDebounce = setTimeout(() => { window.__mailtoDebounce = null; }, 2000);
                window.location.href = `mailto:caseyglarkin2@gmail.com?subject=${subject}&body=${body}`;
              }
              return;
            }
            const body = {
              event: eventName,
              at: new Date().toISOString(),
              href: window.location.href,
              userAgent: navigator.userAgent,
              referrer: document.referrer,
              ...payload,
            };
            await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body),
              keepalive: true,
            });
          } catch (e) {
            console.warn('notifyEvent failed', e);
          }
        }


        const styles = `
          @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

          :root {
            --bg-dark: #050505;
            --neon-cyan: #00FFC2;
            --alert-red: #FF2A00;
          }

          body {
            background-color: var(--bg-dark);
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
          }

          .mono {
            font-family: 'JetBrains Mono', monospace;
          }

          .text-neon {
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 255, 194, 0.5);
          }

          .border-neon {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 194, 0.2);
          }

          .bg-neon {
            background-color: var(--neon-cyan);
          }

          .text-shadow-neon {
            text-shadow: 0 0 20px rgba(0, 255, 194, 0.6);
          }

          .text-alert {
            color: var(--alert-red);
            text-shadow: 0 0 10px rgba(255, 42, 0, 0.5);
          }

          .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 194, 0.02) 51%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
          }

          .glitch-wrapper {
            position: relative;
            display: inline-block;
          }

          .glitch-wrapper::before, .glitch-wrapper::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
          }

          .glitch-wrapper::before {
            left: 2px;
            text-shadow: -1px 0 #FF2A00;
            clip-path: inset(20% 0 80% 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
          }

          .glitch-wrapper::after {
            left: -2px;
            text-shadow: -1px 0 #00FFC2;
            clip-path: inset(60% 0 10% 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
          }

          @keyframes glitch-anim {
            0% { clip-path: inset(10% 0 90% 0); }
            20% { clip-path: inset(60% 0 10% 0); }
            40% { clip-path: inset(30% 0 50% 0); }
            60% { clip-path: inset(80% 0 5% 0); }
            80% { clip-path: inset(10% 0 60% 0); }
            100% { clip-path: inset(40% 0 20% 0); }
          }

          @keyframes glitch-anim-2 {
            0% { clip-path: inset(15% 0 80% 0); }
            20% { clip-path: inset(80% 0 10% 0); }
            40% { clip-path: inset(40% 0 50% 0); }
            60% { clip-path: inset(10% 0 40% 0); }
            80% { clip-path: inset(70% 0 20% 0); }
            100% { clip-path: inset(20% 0 70% 0); }
          }

          .bar {
            animation: sound 0ms -800ms linear infinite alternate;
          }

          @keyframes sound {
            0% { opacity: .35; height: 3px; }
            100% { opacity: 1; height: 100%; }
          }

          @keyframes pulse-neon {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 194, 0.4), 0 0 20px rgba(0, 255, 194, 0.2); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 194, 0.8), 0 0 40px rgba(0, 255, 194, 0.4), 0 0 60px rgba(0, 255, 194, 0.2); }
          }

          .pulse-glow {
            animation: pulse-neon 2s ease-in-out infinite;
          }

          @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
          }

          .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            top: 0;
            animation: confetti-fall 3s ease-out forwards;
            z-index: 9999;
          }

          @media (max-width: 768px) {
            .mobile-touch-target { min-height: 48px; }
          }
        `;

        // Section Header Component
        const SectionHeader = ({ title, subtitle, number }) => (
          <div className="flex items-end gap-4 mb-12 border-b border-gray-800 pb-4">
            <span className="mono text-neon text-4xl font-bold opacity-50">{number}</span>
            <div>
              <h2 className="text-4xl font-bold uppercase tracking-tighter glitch-wrapper" data-text={title}>{title}</h2>
              <p className="mono text-gray-500 text-sm mt-1 uppercase tracking-widest">{subtitle}</p>
            </div>
          </div>
        );

        // Hero Component
        const Hero = () => {
          return (
            <section className="min-h-screen flex flex-col justify-center relative px-6 md:px-20 pt-20 overflow-hidden">
              <div className="absolute top-0 right-0 w-1/2 h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] pointer-events-none"></div>
              
              <div className="z-10 max-w-5xl">
                <div className="flex items-center gap-2 mb-6">
                  <span className="animate-pulse w-3 h-3 bg-neon rounded-full"></span>
                  <span className="mono text-neon text-sm">SYSTEM: SECURE // CONNECTED TO LIA CORE</span>
                </div>
                
                <h1 className="text-6xl md:text-8xl font-black uppercase leading-[0.9] mb-8 tracking-tight">
                  You Merely <span className="text-gray-600">Adopted</span> <br/>
                  The Supply Chain. <br/>
                  We Were <span className="text-neon glitch-wrapper" data-text="BORN IN IT">BORN IN IT</span>.
                </h1>

                <p className="text-xl md:text-2xl text-gray-400 max-w-2xl leading-relaxed border-l-4 border-neon pl-6 mb-10">
                  Most agencies see trucks and boxes. We see the 3 AM detention fees. 
                  We see the AOG burning cash on the tarmac. 
                  <br/><br/>
                  <span className="text-white font-bold">Sensos needs a weapon, not a brochure.</span>
                </p>

                <div className="flex flex-col md:flex-row gap-4">
                  <a href="#proposal" className="group bg-neon text-black px-8 py-4 font-bold text-lg uppercase tracking-wide flex items-center gap-2 hover:bg-white transition-colors">
                    <Terminal size={20} /> Step 1: See The Plan
                  </a>
                  <a href="#sign" onClick={(e) => { e.preventDefault(); notifyEvent('cta_review_sign_click', {}, { interactive: true }); window.dispatchEvent(new CustomEvent('open-manifesto-reader')); }} className="group border border-neon text-neon px-8 py-4 font-bold text-lg uppercase tracking-wide flex items-center gap-2 hover:bg-neon hover:text-black transition-colors">
                    <ShieldAlert size={20} /> Step 2: Review & Sign
                  </a>
                  <div className="border border-gray-700 px-8 py-4 flex items-center gap-4 bg-black/50 backdrop-blur-sm">
                    <div className="text-right">
                      <div className="text-xs text-gray-500 uppercase mono">Presented By</div>
                      <div className="font-bold text-white">CASEY LARKIN</div>
                    </div>
                    <div className="h-10 w-10 bg-gray-800 rounded-full flex items-center justify-center font-bold text-neon border border-neon">CL</div>
                  </div>
                </div>
              </div>

              <div className="absolute bottom-10 right-10 hidden md:block">
                <div className="mono text-xs text-gray-600 text-right">
                  <p>STATUS: OPERATIONAL</p>
                  <p>LATENCY: 12ms</p>
                  <p>ENCRYPTION: AES-256</p>
                  <p className="text-neon animate-pulse">SINGULARITY DETECTED</p>
                </div>
              </div>
            </section>
          );
        };

        // Floating Podcast Player - Listen while you scroll
        const FloatingPodcast = () => {
          const [expanded, setExpanded] = useState(false);
          const [dismissed, setDismissed] = useState(false);
          const fileId = '1MxHxOc8p0LAhKrHzmCojH-bhNFN_HmRv';
          const previewUrl = `https://drive.google.com/file/d/${fileId}/preview`;
          
          if (dismissed) return null;
          
          return (
            <div className="fixed top-20 right-4 z-50 transition-all duration-300">
              <div className={`bg-black border border-neon rounded-lg shadow-[0_0_30px_rgba(0,255,194,0.2)] overflow-hidden transition-all duration-300 ${expanded ? 'w-80' : 'w-auto'}`}>
                {expanded ? (
                  <div>
                    <div className="p-3 border-b border-gray-800 flex items-center justify-between">
                      <div>
                        <div className="text-white font-bold text-sm">üéß The Impetus</div>
                        <div className="text-xs text-gray-400">Listen while you scroll</div>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => setExpanded(false)} className="text-gray-400 hover:text-white text-sm">‚àí</button>
                        <button onClick={() => setDismissed(true)} className="text-gray-400 hover:text-white text-sm">√ó</button>
                      </div>
                    </div>
                    <div className="h-16">
                      <iframe title="Podcast" src={previewUrl} allow="autoplay" className="w-full h-full" />
                    </div>
                  </div>
                ) : (
                  <button onClick={() => setExpanded(true)} className="p-3 flex items-center gap-3 hover:bg-gray-900/50 transition-colors">
                    <span className="text-2xl">üéß</span>
                    <div className="text-left">
                      <div className="text-white text-sm font-medium">Listen while you scroll</div>
                      <div className="text-neon text-xs">Play The Impetus ‚Üí</div>
                    </div>
                  </button>
                )}
              </div>
            </div>
          );
        };

        // Manifesto Podcast Component (Google Drive preview)
        const ManifestoPodcast = () => {
          const fileId = '1MxHxOc8p0LAhKrHzmCojH-bhNFN_HmRv';
          const previewUrl = `https://drive.google.com/file/d/${fileId}/preview`;
          useEffect(() => {
            notifyEvent('podcast_loaded', { fileId });
          }, []);
          return (
            <div className="bg-black border border-neon p-4 relative overflow-hidden">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-white font-bold uppercase">The Impetus ‚Äî Podcast</h3>
                <div className="flex items-center gap-2">
                  <a href={`https://drive.google.com/file/d/${fileId}/view`} target="_blank" rel="noreferrer" onClick={() => notifyEvent('podcast_open_external', { fileId }, { interactive: true })} className="mono text-xs text-neon underline">Open in Tab</a>
                  <button onClick={() => { notifyEvent('manifesto_start_from_podcast'); window.dispatchEvent(new CustomEvent('open-manifesto-reader')); }} className="mono text-xs bg-neon text-black font-bold px-3 py-1">Start Narrated Manifesto</button>
                </div>
              </div>
              <div className="relative w-full aspect-video border border-gray-800">
                <iframe
                  title="Manifesto Podcast"
                  src={previewUrl}
                  allow="autoplay"
                  className="w-full h-full"
                ></iframe>
              </div>
              <div className="mt-2 mono text-xs text-gray-500">If playback fails, request a direct MP4 link for native player.</div>
            </div>
          );
        };

        // Compact Bottom Module: Podcast + Agreement + Sign with Countdown
        function ManifestoExperience() {
          const docId = '1tAgP1DDQbuKkqzKschxu4WU0TnqwMu8lEipqii1kLcg';
          const docPreview = `https://docs.google.com/document/d/${docId}/preview`;
          const podcastId = '1MxHxOc8p0LAhKrHzmCojH-bhNFN_HmRv';
          const podcastUrl = `https://drive.google.com/file/d/${podcastId}/preview`;
          
          // Countdown state
          const DEADLINE_TS = Date.parse('2025-12-15T05:00:00Z');
          const [remaining, setRemaining] = useState(Math.max(0, DEADLINE_TS - Date.now()));
          const [expired, setExpired] = useState(DEADLINE_TS - Date.now() <= 0);
          
          useEffect(() => {
            if (expired) return;
            const tick = () => {
              const rem = DEADLINE_TS - Date.now();
              setRemaining(Math.max(0, rem));
              if (rem <= 0) setExpired(true);
            };
            tick();
            const id = setInterval(tick, 1000);
            return () => clearInterval(id);
          }, [expired]);
          
          const fmt = (ms) => {
            const s = Math.floor(ms/1000);
            const d = Math.floor(s/86400);
            const h = Math.floor((s%86400)/3600);
            const m = Math.floor((s%3600)/60);
            const ss = s%60;
            return d>0 ? `${d}d ${h}h ${m}m ${ss}s` : `${h}h ${m}m ${ss}s`;
          };
          
          return (
            <section id="review-sign" className="py-12 px-6 md:px-12 bg-black border-t-2 border-neon">
              <div className="max-w-7xl mx-auto">
                {/* Header with Countdown */}
                <div className="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
                  <div>
                    <h2 className="text-3xl font-black uppercase text-white">Review & Sign</h2>
                    <p className="mono text-xs text-gray-400">Listen to the podcast while you read the agreement</p>
                  </div>
                  <div className={`px-4 py-2 border ${expired ? 'border-red-500 bg-red-900/20' : 'border-neon bg-neon/10'} rounded`}>
                    <span className={`mono text-sm font-bold ${expired ? 'text-red-400' : 'text-neon'}`}>
                      {expired ? 'OFFER EXPIRED' : `‚è± ${fmt(remaining)}`}
                    </span>
                  </div>
                </div>
                
                {/* Main Content Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-4">
                  {/* Left: Compact Podcast + Summary */}
                  <div className="lg:col-span-4 space-y-4">
                    {/* TL;DR Summary */}
                    <TLDRSummary />
                    
                    <div className="bg-black border border-gray-800/50 p-3 rounded">
                      <h4 className="mono text-xs text-neon mb-2">üéô THE IMPETUS</h4>
                      <div className="aspect-video w-full border border-gray-700 rounded overflow-hidden">
                        <iframe title="Podcast" src={podcastUrl} allow="autoplay" className="w-full h-full" />
                      </div>
                    </div>
                    
                    {/* Savings Callout */}
                    <div className="bg-green-900/20 border border-green-500/50 p-3 rounded text-center">
                      <div className="text-green-400 font-black text-2xl">$229,500+</div>
                      <div className="text-green-300 text-xs">Year 1 savings waiting for your signature</div>
                    </div>
                    
                    {/* Sign CTA with Pulse */}
                    <button 
                      onClick={() => window.dispatchEvent(new CustomEvent('open-real-review-sign-portal'))} 
                      disabled={expired}
                      className={`w-full py-4 font-bold uppercase text-lg rounded transition-all mobile-touch-target ${expired ? 'bg-gray-800 text-gray-500 cursor-not-allowed' : 'bg-neon text-black hover:bg-white pulse-glow'}`}
                    >
                      {expired ? 'Signing Closed' : '‚úçÔ∏è Sign The Agreement'}
                    </button>
                    
                    {/* Trust Badge */}
                    <TrustBadge />
                  </div>
                  
                  {/* Right: Document Viewer */}
                  <div className="lg:col-span-8 bg-black border border-neon shadow-[0_0_20px_rgba(0,255,194,0.1)] rounded overflow-hidden relative">
                    <div className="absolute inset-0 pointer-events-none opacity-5 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]" />
                    <iframe title="Agreement" src={docPreview} className="w-full h-[50vh] lg:h-[60vh]" />
                  </div>
                </div>
              </div>
            </section>
          );
        }

        // The Problem Component
        const TheProblem = () => {
          return (
            <section className="py-20 px-6 md:px-20 border-y border-gray-800/50">
              <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div>
                  <SectionHeader number="01" title="Visibility Is Dead" subtitle="The Legacy Narrative Collapse" />
                  <p className="text-lg text-gray-400 mb-6">
                    The industry is drowning in "Control Towers" that are really just observation decks for chaos.
                    Visibility is passive. It's watching a disaster happen in real-time.
                  </p>
                  <p className="text-lg text-gray-400 mb-8">
                    <strong className="text-white">Sensos is the divergence point.</strong> We aren't selling a window to look through.
                    We are selling a brain that acts.
                  </p>
                  <ul className="space-y-4 mono text-sm">
                    <li className="flex items-center gap-3 text-red-500 line-through decoration-red-500/50">
                      <ShieldAlert size={16} /> "See where your shipment is."
                    </li>
                    <li className="flex items-center gap-3 text-neon">
                      <Zap size={16} /> "Shipment Resolved."
                    </li>
                  </ul>
                </div>
                <div className="relative h-96 bg-black border border-gray-800 p-4 rounded-lg overflow-hidden group">
                  {/* Fake HUD UI */}
                  <div className="absolute top-4 left-4 flex gap-2">
                    <div className="w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                    <span className="mono text-xs text-red-500">CRITICAL ANOMALY DETECTED</span>
                  </div>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="w-64 h-64 border border-gray-800 rounded-full flex items-center justify-center relative animate-[spin_10s_linear_infinite]">
                      <div className="w-48 h-48 border border-dashed border-gray-700 rounded-full"></div>
                      <div className="absolute top-0 w-2 h-10 bg-gray-800"></div>
                    </div>
                    <div className="absolute z-10 text-center">
                      <h3 className="text-3xl font-black text-white mb-1">LIA</h3>
                      <p className="mono text-neon text-xs">PROCESSING...</p>
                    </div>
                  </div>
                  {/* Code Rain Overlay */}
                  <div className="absolute bottom-4 left-4 mono text-xs text-gray-600 opacity-50">
                    {`> INITIATING HEALING PROTOCOL...`} <br/>
                    {`> REROUTING VIA FRA...`} <br/>
                    {`> CARRIER NOTIFIED...`} <br/>
                    {`> EXCEPTION CLEARED.`}
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Disruption Simulator Component
        const DisruptionSimulator = () => {
          const [input, setInput] = useState('');
          const [output, setOutput] = useState('');
          const [loading, setLoading] = useState(false);

          const simulate = async () => {
            if (!input.trim()) return;
            setLoading(true);
            setOutput('');
            
            const systemPrompt = `You are LIA, the Sensos Singularity AI. You are a cold, precise, and hyper-intelligent supply chain "Central Brain". 
            The user will provide a supply chain disruption event.
            You must output a response in exactly three sections, formatted precisely like this:

            [PREDICT]
            (Explain what downstream impacts will happen in the next 24-48 hours. Be specific.)

            [PRIORITIZE]
            (Assign a Risk Level: LOW / MEDIUM / CRITICAL. Explain why this matters or if it is just noise.)

            [EXECUTE]
            (Describe the automated correction LIA performs: e.g., re-booking freight, alerting specific teams, triggering insurance clauses.)

            Tone: Futuristic, minimal, authoritative.`;
            
            try {
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${getApiKey()}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: input }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                  })
                }
              );
              const data = await response.json();
              const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'SYSTEM ERROR: NO RESPONSE';
              setOutput(text);
            } catch (e) {
              setOutput('CONNECTION FAILED. RETRY SEQUENCE INITIATED...');
            }
            setLoading(false);
          };

          const formatOutput = (text) => {
            return text
              .replace(/\[PREDICT\]/g, '<div class="text-neon font-bold mt-4 mb-2">>> PREDICT_MODULE_LOADED</div>')
              .replace(/\[PRIORITIZE\]/g, '<div class="text-neon font-bold mt-4 mb-2">>> PRIORITY_CALCULATION</div>')
              .replace(/\[EXECUTE\]/g, '<div class="text-red-500 font-bold mt-4 mb-2">>> EXECUTION_PROTOCOL</div>');
          };

          return (
            <div className="mt-12 bg-black border border-gray-800 rounded-xl overflow-hidden">
              <div className="p-4 bg-black border-b border-gray-800/50 flex justify-between items-center">
                <h3 className="font-bold text-lg flex items-center gap-2">
                  <ShieldAlert size={18} className="text-neon" />
                  DISRUPTION SIMULATOR
                </h3>
                <span className="mono text-xs text-gray-500">LIA NEURAL ENGINE</span>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-gray-800/50">
                {/* Input */}
                <div className="p-6">
                  <p className="text-gray-400 text-sm mb-4">
                    Enter a supply chain disruption. LIA will <span className="text-neon">Predict</span> impacts, 
                    <span className="text-neon"> Prioritize</span> response, and <span className="text-red-400">Execute</span> corrections.
                  </p>
                  <textarea
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    placeholder="e.g. Port of Rotterdam closed due to storm, 3 containers stuck with perishable pharma goods..."
                    className="w-full h-32 bg-black border border-gray-700 p-3 text-white text-sm focus:border-neon outline-none resize-none"
                  />
                  <button
                    onClick={simulate}
                    disabled={loading || !input.trim()}
                    className="mt-4 w-full py-3 bg-neon text-black font-bold uppercase flex items-center justify-center gap-2 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed mobile-touch-target"
                  >
                    {loading ? <><Loader size={18} className="animate-spin" /> ANALYZING...</> : <><Zap size={18} /> RUN SIMULATION</>}
                  </button>
                </div>
                
                {/* Output */}
                <div className="p-6 bg-black">
                  <div className="mono text-xs text-gray-500 mb-2">// LIA RESPONSE</div>
                  {loading ? (
                    <div className="text-neon animate-pulse">LIA IS ANALYZING GLOBAL NODES...</div>
                  ) : output ? (
                    <div className="text-sm text-gray-300 leading-relaxed mono" dangerouslySetInnerHTML={{ __html: formatOutput(output) }} />
                  ) : (
                    <div className="text-gray-600 text-sm">Awaiting disruption input...</div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        // Pre-Show Outreach Drafter - Compact inline component for booking meetings before Manifest
        const PreShowOutreachDrafter = () => {
          const [target, setTarget] = useState('');
          const [output, setOutput] = useState('');
          const [loading, setLoading] = useState(false);
          const [outreachType, setOutreachType] = useState('email');

          const assets = [
            { id: 'monolith', name: 'The Monolith Experience', desc: 'Booth #TBD - Interactive crisis simulation' },
            { id: 'warroom', name: '12:30 Anomaly War Game', desc: 'Live disruption challenge with prizes' },
            { id: 'hafla', name: 'Night 1: The Hafla @ Miznon', desc: 'Invite-only dinner experience' },
            { id: 'sanctuary', name: 'Night 2: The Sanctuary @ Tao', desc: 'C-Suite closing dinner' },
          ];

          const [selectedAssets, setSelectedAssets] = useState(['monolith', 'warroom']);

          const toggleAsset = (id) => {
            setSelectedAssets(prev => 
              prev.includes(id) ? prev.filter(a => a !== id) : [...prev, id]
            );
          };

          const generateOutreach = async () => {
            if (!target.trim()) return;
            setLoading(true);
            setOutput('');

            const selectedAssetNames = assets.filter(a => selectedAssets.includes(a.id)).map(a => `${a.name}: ${a.desc}`).join('\n- ');

            const systemPrompt = `You are a sales outreach specialist for Sensos, a supply chain AI company attending Manifest 2026 in Las Vegas (Feb 10-12).

            Generate a ${outreachType === 'email' ? 'short email (under 100 words)' : 'LinkedIn message (under 50 words)'} to book a meeting with this person BEFORE the show.

            Tone: Confident but not pushy. Create urgency around limited availability.
            Goal: Get a 15-minute slot on their calendar during Manifest.
            
            Assets to highlight based on selection:
            - ${selectedAssetNames}

            Key messaging:
            - Sensos turns supply chain chaos into controlled outcomes
            - LIA (our AI) doesn't just predict‚Äîit executes
            - "Stop viewing data. Start executing."
            
            ${outreachType === 'email' ? 'Include a clear CTA to book time. Sign off as the Sensos Team.' : 'Keep it conversational and include a soft ask for a quick chat.'}`;

            try {
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${getApiKey()}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: `Target: ${target}\nOutreach type: ${outreachType}` }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                  })
                }
              );
              const data = await response.json();
              const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Error generating outreach';
              setOutput(text);
            } catch (e) {
              setOutput('Connection failed. Please try again.');
            }
            setLoading(false);
          };

          const copyToClipboard = () => {
            navigator.clipboard.writeText(output);
            window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Copied to clipboard!' } }));
          };

          return (
            <div className="space-y-3">
              {/* Target Input */}
              <input
                type="text"
                value={target}
                onChange={(e) => setTarget(e.target.value)}
                placeholder="Who are you reaching out to? e.g. VP Supply Chain @ Pfizer"
                className="w-full bg-black/50 border border-gray-700 p-2 text-white text-sm focus:border-neon outline-none rounded"
              />

              {/* Outreach Type Toggle */}
              <div className="flex gap-2">
                <button
                  onClick={() => setOutreachType('email')}
                  className={`flex-1 py-1.5 text-xs font-medium rounded transition-all ${outreachType === 'email' ? 'bg-neon text-black' : 'bg-black border border-gray-700 text-gray-400 hover:border-gray-600'}`}
                >
                  üìß Email
                </button>
                <button
                  onClick={() => setOutreachType('linkedin')}
                  className={`flex-1 py-1.5 text-xs font-medium rounded transition-all ${outreachType === 'linkedin' ? 'bg-neon text-black' : 'bg-black border border-gray-700 text-gray-400 hover:border-gray-600'}`}
                >
                  üíº LinkedIn
                </button>
              </div>

              {/* Asset Selection */}
              <div>
                <div className="mono text-xs text-gray-500 mb-1.5">ASSETS TO SHARE:</div>
                <div className="grid grid-cols-2 gap-1.5">
                  {assets.map(asset => (
                    <button
                      key={asset.id}
                      onClick={() => toggleAsset(asset.id)}
                      className={`p-2 text-left text-xs rounded transition-all ${selectedAssets.includes(asset.id) ? 'bg-neon/10 border border-neon/50 text-neon' : 'bg-black/30 border border-gray-800 text-gray-500 hover:border-gray-700'}`}
                    >
                      {asset.name}
                    </button>
                  ))}
                </div>
              </div>

              {/* Generate Button */}
              <button
                onClick={generateOutreach}
                disabled={loading || !target.trim()}
                className="w-full py-2.5 bg-neon text-black font-bold text-sm flex items-center justify-center gap-2 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed rounded"
              >
                {loading ? <><Loader size={14} className="animate-spin" /> DRAFTING...</> : <><Sparkles size={14} /> DRAFT OUTREACH</>}
              </button>

              {/* Output */}
              {output && (
                <div className="bg-black/50 border border-gray-800 rounded p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="mono text-xs text-gray-500">GENERATED {outreachType.toUpperCase()}</span>
                    <button onClick={copyToClipboard} className="text-xs text-neon hover:text-white flex items-center gap-1">
                      <Download size={10} /> Copy
                    </button>
                  </div>
                  <div className="text-sm text-gray-300 leading-relaxed whitespace-pre-wrap">{output}</div>
                </div>
              )}
            </div>
          );
        };

        // Strategy Drafter Component
        const StrategyDrafter = () => {
          const [stakeholder, setStakeholder] = useState('');
          const [output, setOutput] = useState('');
          const [loading, setLoading] = useState(false);

          const draft = async () => {
            if (!stakeholder.trim()) return;
            setLoading(true);
            setOutput('');
            
            const systemPrompt = `You are a strategic communications AI for Sensos. 
            The user is targeting a specific stakeholder for the "Manifest 2026" event activation.
            Draft a short, punchy, high-impact cold email to this person.
            
            Context:
            - Event: Manifest 2026 in Las Vegas.
            - Brand Tone: "The Singularity" (Bold, futuristic, decisive).
            - Key Offerings: "The Monolith" booth, "12:30 Anomaly" war game, "Tale of Two Cities" dinner.
            - Value Prop: Stop viewing data, start executing actions.
            
            Keep it under 150 words. Sign off as "The Sensos Team".`;
            
            try {
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${getApiKey()}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: `Target Stakeholder: ${stakeholder}` }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                  })
                }
              );
              const data = await response.json();
              const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'SYSTEM ERROR: NO RESPONSE';
              setOutput(text);
            } catch (e) {
              setOutput('CONNECTION FAILED. RETRY SEQUENCE INITIATED...');
            }
            setLoading(false);
          };

          const copyToClipboard = () => {
            navigator.clipboard.writeText(output);
            window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Copied to clipboard!' } }));
          };

          return (
            <div id="strategy-drafter-section" className="mt-8 bg-black border border-gray-800 rounded-xl overflow-hidden strategy-drafter-section">
              <div className="p-4 bg-black border-b border-gray-800/50 flex justify-between items-center">
                <h3 className="font-bold text-lg flex items-center gap-2">
                  <Terminal size={18} className="text-neon" />
                  STRATEGY DRAFTER
                </h3>
                <span className="mono text-xs text-gray-500">MANIFEST 2026 OUTREACH</span>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-gray-800/50">
                {/* Input */}
                <div className="p-6">
                  <p className="text-gray-400 text-sm mb-4">
                    Enter a target stakeholder for Manifest 2026. LIA will generate a 
                    <span className="text-neon"> high-impact cold email</span> tailored to their role.
                  </p>
                  <input
                    type="text"
                    value={stakeholder}
                    onChange={(e) => setStakeholder(e.target.value)}
                    placeholder="e.g. VP of Supply Chain at Pfizer, Logistics Director at Nike..."
                    className="w-full bg-black border border-gray-700 p-3 text-white text-sm focus:border-neon outline-none"
                  />
                  <button
                    onClick={draft}
                    disabled={loading || !stakeholder.trim()}
                    className="mt-4 w-full py-3 bg-neon text-black font-bold uppercase flex items-center justify-center gap-2 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed mobile-touch-target"
                  >
                    {loading ? <><Loader size={18} className="animate-spin" /> GENERATING...</> : <><Sparkles size={18} /> DRAFT PITCH</>}
                  </button>
                </div>
                
                {/* Output */}
                <div className="p-6 bg-black">
                  <div className="flex justify-between items-center mb-2">
                    <div className="mono text-xs text-gray-500">// GENERATED EMAIL</div>
                    {output && (
                      <button onClick={copyToClipboard} className="text-xs text-neon hover:text-white flex items-center gap-1">
                        <Download size={12} /> Copy
                      </button>
                    )}
                  </div>
                  {loading ? (
                    <div className="text-white animate-pulse">GENERATING NEURAL PITCH...</div>
                  ) : output ? (
                    <div className="text-sm text-gray-300 leading-relaxed whitespace-pre-wrap">{output}</div>
                  ) : (
                    <div className="text-gray-600 text-sm">Enter a stakeholder to generate outreach...</div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        // Strategy Component
        const Strategy = () => {
          const pillars = [
            {
              title: "The Void",
              desc: "Vantablack Aesthetic. The unknown depth of the supply chain.",
              color: "border-gray-800",
              icon: <Globe className="text-gray-500" />
            },
            {
              title: "The Pulse",
              desc: "Bio-Electric Cyan. The signal cutting through the noise.",
              color: "border-neon",
              icon: <Activity className="text-neon" />
            },
            {
              title: "The Brain",
              desc: "Agentic AI. LIA doesn't report. She executes.",
              color: "border-white",
              icon: <Brain className="text-white" />
            }
          ];

          return (
            <section className="py-24 px-6 md:px-20 relative">
              <div className="max-w-7xl mx-auto">
                <SectionHeader number="02" title="The Singularity" subtitle="Strategic Master Plan" />
                
                <div className="mb-16 max-w-3xl">
                  <p className="text-xl leading-relaxed text-gray-300">
                    In astrophysics, a singularity is where the old rules of physics break down. 
                    In logistics, it's the moment <span className="text-neon">Sensos LIA</span> collapses 
                    the distance between "Warning" and "Fix".
                  </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                  {pillars.map((p, i) => (
                    <div key={i} className={`bg-black/50 border ${p.color} p-8 hover:bg-black/80 hover:border-neon transition-all duration-300 group`}>
                      <div className="mb-6">{p.icon}</div>
                      <h3 className="text-2xl font-bold mb-3 uppercase">{p.title}</h3>
                      <p className="text-gray-400 text-sm mono leading-relaxed">{p.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>
          );
        };

        // Section 03: The Competitive Edge - Why This Matters Now
        const CompetitiveEdge = () => {
          const advantages = [
            {
              title: 'Speed-to-Market',
              stat: '8 weeks',
              desc: 'From signed SOW to live rebrand. Agencies quote 16-20.',
              icon: '‚ö°'
            },
            {
              title: 'Sign Deals On-Site',
              stat: 'Real-time',
              desc: 'This proposal has a signature workflow. Imagine that at the booth.',
              icon: '‚úçÔ∏è'
            },
            {
              title: 'Provable Attribution',
              stat: '100%',
              desc: 'Every lead tracked from booth scan to closed deal. No guessing.',
              icon: 'üìä'
            },
            {
              title: 'Network Depth',
              stat: '2 Gen',
              desc: 'Two generations of freight relationships. Doors that don\'t open for agencies.',
              icon: 'üîó'
            }
          ];
          
          return (
            <section className="py-24 px-6 md:px-20 border-t border-gray-800/50">
              <div className="max-w-6xl mx-auto">
                <SectionHeader number="03" title="The Competitive Edge" subtitle="Why This Partnership Wins" />
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start mb-16">
                  <div>
                    <p className="text-xl text-gray-300 mb-6 leading-relaxed">
                      Other agencies deliver decks. We deliver <span className="text-white font-bold">closed deals</span>.
                    </p>
                    <p className="text-gray-400 mb-6 leading-relaxed">
                      The strategy, the timeframe, the messaging architecture‚Äîthose are differentiators. 
                      But the real unlock? <span className="text-neon">The network.</span>
                    </p>
                    <p className="text-gray-400 mb-8 leading-relaxed">
                      Two generations of freight industry relationships. FreightWaves alumni network. 
                      Podcast guests who became partners. When Sensos invests in DWTB?!, you're not just 
                      buying services‚Äîyou're buying <span className="text-white">access</span>.
                    </p>
                    
                    <div className="p-4 bg-black border border-neon/30 shadow-[0_0_20px_rgba(0,255,194,0.1)]">
                      <div className="mono text-xs text-neon mb-2">THE UNSPOKEN ADVANTAGE</div>
                      <p className="text-sm text-gray-300 leading-relaxed">
                        What happens when you combine best-in-class creative execution with a Rolodex 
                        that took decades to build? Returns that blow traditional agency ROI out of the water.
                      </p>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4">
                    {advantages.map((adv, i) => (
                      <div key={i} className="bg-black border border-gray-800/50 p-5 hover:border-neon/30 transition-all group">
                        <div className="text-2xl mb-3">{adv.icon}</div>
                        <div className="mono text-2xl text-neon font-bold mb-1">{adv.stat}</div>
                        <div className="text-white font-medium text-sm mb-2">{adv.title}</div>
                        <div className="text-xs text-gray-500">{adv.desc}</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Manifest Plan Component with Monolith Mockup
        const ManifestPlan = () => {
          const [hoveredZone, setHoveredZone] = useState(null);
          
          return (
            <section className="py-24 px-6 md:px-20 border-t border-b border-gray-800/50">
              <div className="max-w-7xl mx-auto">
                <SectionHeader number="06" title="Manifest 2026" subtitle="Operation: Dominance" />
                
                {/* THE MONOLITH MOCKUP */}
                <div className="mb-16 relative">
                  <div className="text-center mb-8">
                    <h3 className="text-3xl font-bold text-white mb-2">THE MONOLITH</h3>
                    <p className="text-gray-400 text-sm">Booth #337 ‚Ä¢ 20x20 ‚Ä¢ The Black Box</p>
                  </div>
                  
                  {/* 3D-ish Booth Visualization */}
                  <div className="relative max-w-4xl mx-auto">
                    {/* Main Booth Structure */}
                    <div className="relative bg-black border-2 border-gray-800 aspect-[16/9] overflow-hidden">
                      {/* Ambient Glow */}
                      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-neon/10 via-transparent to-transparent animate-pulse"></div>
                      
                      {/* Mesh Facade Lines */}
                      <div className="absolute inset-0 opacity-20">
                        {[...Array(20)].map((_, i) => (
                          <div key={i} className="absolute w-full h-px bg-gradient-to-r from-transparent via-neon to-transparent" style={{ top: `${(i + 1) * 5}%` }}></div>
                        ))}
                        {[...Array(30)].map((_, i) => (
                          <div key={i} className="absolute h-full w-px bg-gradient-to-b from-transparent via-neon/50 to-transparent" style={{ left: `${(i + 1) * 3.33}%` }}></div>
                        ))}
                      </div>
                      
                      {/* Central LIA Pillar */}
                      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-48 md:w-48 md:h-64">
                        <div className="relative w-full h-full">
                          <div className="absolute inset-0 border border-neon/50 bg-black/80"></div>
                          <div className="absolute inset-2 border border-neon/30"></div>
                          <div className="absolute inset-0 flex items-center justify-center">
                            <div className="text-center">
                              <div className="text-neon text-4xl md:text-6xl font-black animate-pulse">LIA</div>
                              <div className="mono text-xs text-gray-500 mt-2">NEURAL CORE</div>
                            </div>
                          </div>
                          {/* Hologram Effect */}
                          <div className="absolute -top-8 left-1/2 -translate-x-1/2 w-full h-8 bg-gradient-to-t from-neon/20 to-transparent"></div>
                          <div className="absolute -bottom-4 left-1/2 -translate-x-1/2 w-3/4 h-4 bg-neon/20 blur-xl"></div>
                        </div>
                      </div>
                      
                      {/* Interactive Hotspots */}
                      <div 
                        className="absolute top-4 left-4 md:top-8 md:left-8 cursor-pointer group"
                        onMouseEnter={() => setHoveredZone('entry')}
                        onMouseLeave={() => setHoveredZone(null)}
                      >
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'entry' ? 'bg-neon' : 'bg-neon/50'} animate-ping absolute`}></div>
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'entry' ? 'bg-neon' : 'bg-neon/50'} relative`}></div>
                        {hoveredZone === 'entry' && (
                          <div className="absolute left-6 top-0 bg-black border border-neon p-3 w-48 z-10">
                            <div className="mono text-xs text-neon mb-1">VELVET ROPE ENTRY</div>
                            <p className="text-xs text-gray-400">Controlled access. Creates intrigue and FOMO.</p>
                          </div>
                        )}
                      </div>
                      
                      <div 
                        className="absolute top-4 right-4 md:top-8 md:right-8 cursor-pointer"
                        onMouseEnter={() => setHoveredZone('demo')}
                        onMouseLeave={() => setHoveredZone(null)}
                      >
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'demo' ? 'bg-neon' : 'bg-neon/50'} animate-ping absolute`}></div>
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'demo' ? 'bg-neon' : 'bg-neon/50'} relative`}></div>
                        {hoveredZone === 'demo' && (
                          <div className="absolute right-6 top-0 bg-black border border-neon p-3 w-48 z-10">
                            <div className="mono text-xs text-neon mb-1">DEMO STATIONS</div>
                            <p className="text-xs text-gray-400">Interactive WebGL experiences on tablets. Sign deals on-site.</p>
                          </div>
                        )}
                      </div>
                      
                      <div 
                        className="absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer"
                        onMouseEnter={() => setHoveredZone('scan')}
                        onMouseLeave={() => setHoveredZone(null)}
                      >
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'scan' ? 'bg-neon' : 'bg-neon/50'} animate-ping absolute`}></div>
                        <div className={`w-4 h-4 rounded-full ${hoveredZone === 'scan' ? 'bg-neon' : 'bg-neon/50'} relative`}></div>
                        {hoveredZone === 'scan' && (
                          <div className="absolute bottom-6 left-1/2 -translate-x-1/2 bg-black border border-neon p-3 w-56 z-10">
                            <div className="mono text-xs text-neon mb-1">QR CAPTURE ZONE</div>
                            <p className="text-xs text-gray-400">Every visitor tracked. HubSpot integration. Provable ROI.</p>
                          </div>
                        )}
                      </div>
                      
                      {/* Corner Accents */}
                      <div className="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-neon"></div>
                      <div className="absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-neon"></div>
                      <div className="absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-neon"></div>
                      <div className="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-neon"></div>
                      
                      {/* FOMO Indicators */}
                      <div className="absolute bottom-4 left-4 md:bottom-8 md:left-8">
                        <div className="flex items-center gap-2">
                          <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                          <span className="mono text-xs text-red-400">CAPACITY LIMITED</span>
                        </div>
                      </div>
                      
                      <div className="absolute bottom-4 right-4 md:bottom-8 md:right-8">
                        <div className="flex items-center gap-2">
                          <span className="mono text-xs text-gray-500">INVITE ONLY</span>
                          <div className="w-2 h-2 bg-neon rounded-full"></div>
                        </div>
                      </div>
                    </div>
                    
                    {/* Booth Legend */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                      <div className="text-center p-3 border border-gray-800/50">
                        <div className="mono text-xl text-neon font-bold">20x20</div>
                        <div className="text-xs text-gray-500">Square Feet</div>
                      </div>
                      <div className="text-center p-3 border border-gray-800/50">
                        <div className="mono text-xl text-neon font-bold">4</div>
                        <div className="text-xs text-gray-500">Demo Stations</div>
                      </div>
                      <div className="text-center p-3 border border-gray-800/50">
                        <div className="mono text-xl text-neon font-bold">1</div>
                        <div className="text-xs text-gray-500">LIA Hologram</div>
                      </div>
                      <div className="text-center p-3 border border-gray-800/50">
                        <div className="mono text-xl text-neon font-bold">‚àû</div>
                        <div className="text-xs text-gray-500">FOMO Generated</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
                  {/* The War Game */}
                  <div className="lg:col-span-6 bg-black border border-gray-800/50 p-8">
                    <div className="flex items-center gap-2 mb-4 text-alert">
                      <Radio size={20} className="animate-pulse" />
                      <span className="mono font-bold">12:30 PM - ROUNDTABLE</span>
                    </div>
                    <h3 className="text-2xl font-bold mb-4">THE WAR GAME</h3>
                    <p className="text-sm text-gray-400 mb-6">
                      No panels. We hand out "Crisis Cards" (e.g., Pharma Excursion). 
                      Let them fail with their current tools. Then show LIA solving it in seconds.
                    </p>
                    <div className="p-4 bg-black/50 border border-red-900/30 rounded">
                      <p className="mono text-xs text-red-400">"Your shipment is spoiling in Dubai. You are asleep. What now?"</p>
                    </div>
                  </div>
                  
                  {/* Pre-Show Outreach Drafter */}
                  <div className="lg:col-span-6 bg-black border border-gray-800/50 p-6">
                    <div className="mono text-xs text-gray-500 mb-3">PRE-SHOW OUTREACH AUTOMATION</div>
                    <h3 className="text-xl font-bold mb-2">Book Meetings Before You Land</h3>
                    <p className="text-sm text-gray-400 mb-4">
                      Generate personalized outreach to get meetings on the calendar <span className="text-neon">before</span> Manifest.
                    </p>
                    <PreShowOutreachDrafter />
                  </div>

                  {/* The Dinners */}
                  <div className="lg:col-span-12 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-black p-8 border border-gray-800/50 hover:border-neon/30 transition-colors">
                      <div className="flex justify-between items-start mb-4">
                        <h3 className="text-2xl font-bold text-white">NIGHT 1: THE HAFLA</h3>
                        <span className="mono text-xs bg-neon/10 text-neon px-2 py-1 rounded border border-neon/30">MIZNON</span>
                      </div>
                      <p className="text-gray-400 text-sm">
                        Chaos. Energy. Arak shots and whole cauliflowers thrown on tables. 
                        We break the ice by being "Freight Famous."
                      </p>
                    </div>
                    <div className="bg-black p-8 border border-gray-800 relative">
                      <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-red-900/20 via-black to-black opacity-50"></div>
                      <div className="relative z-10">
                        <div className="flex justify-between items-start mb-4">
                          <h3 className="text-2xl font-bold text-white">NIGHT 2: THE SANCTUARY</h3>
                          <span className="mono text-xs bg-red-900/30 text-red-400 px-2 py-1 rounded">TAO</span>
                        </div>
                        <p className="text-gray-400 text-sm">
                          Silence. Control. The Opium Room. This is where we close the C-Suite 
                          with precise service and absolute confidence.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Execution Playbook Component - The Revenue Engine
        const ExecutionPlaybook = () => {
          const [expandedPhase, setExpandedPhase] = useState(null);
          
          const phases = [
            {
              id: 1,
              phase: 'PHASE 1',
              title: 'The Foundation',
              subtitle: 'Rebrand + WebGL Experience',
              timeline: 'Weeks 1-8',
              agencyPrice: '$111,500',
              dudePrice: '$75,000',
              savings: '$36,500',
              thesis: 'Before Manifest, you need a brand that demands attention. The Singularity rebrand positions Sensos as the inevitable force in freight visibility.',
              deliverables: [
                { name: 'Brand Strategy & Positioning', desc: 'Messaging hierarchy, voice/tone guide, competitive differentiation' },
                { name: 'Visual Identity System', desc: 'Logo evolution, color system, typography, iconography' },
                { name: 'WebGL Marketing Site', desc: 'Interactive 3D experience like this proposal‚Äîbut for prospects' },
                { name: 'Conversion Architecture', desc: 'HubSpot forms, lead scoring, nurture sequences' },
                { name: 'Sales Enablement Kit', desc: 'Pitch deck, one-pagers, case study templates' }
              ],
              outcome: 'A digital presence that stops scrolling and starts conversations.',
              icon: '‚óÜ'
            },
            {
              id: 2,
              phase: 'PHASE 2',
              title: 'The Moment',
              subtitle: 'Manifest 2025 Domination',
              timeline: 'Weeks 6-12',
              agencyPrice: '$58,000',
              dudePrice: '$15,000',
              savings: '$43,000',
              thesis: 'Manifest is the jungle. 5,000+ decision-makers in one building. We turn the Monolith booth into a revenue-generating machine.',
              deliverables: [
                { name: 'Booth Experience Design', desc: 'Traffic flow, demo stations, conversation triggers' },
                { name: 'Interactive Demo Build', desc: 'Site like THIS running at the booth‚Äîaccessible on every phone' },
                { name: 'Lead Capture System', desc: 'Real-time HubSpot integration, automatic follow-up sequences' },
                { name: 'Event Content Strategy', desc: 'Social posts, live coverage, thought leadership moments' },
                { name: 'Hospitality Program', desc: 'VIP dinner strategy, C-suite targeting, relationship acceleration' }
              ],
              outcome: 'Tie every lead directly back to the event. Prove ROI in real-time.',
              icon: '‚óâ'
            },
            {
              id: 3,
              phase: 'PHASE 3',
              title: 'The Momentum',
              subtitle: 'Ongoing Strategic Partnership',
              timeline: 'Month 4+',
              agencyPrice: '$24,500/mo',
              dudePrice: '$12,000/mo',
              savings: '$12,500/mo',
              thesis: 'Manifest opens doors. We make sure they stay open. Continuous brand velocity, pipeline acceleration, and media presence.',
              deliverables: [
                { name: 'Content Engine', desc: 'Thought leadership, case studies, social presence' },
                { name: 'PR & Media Outreach', desc: 'Press releases, journalist relationships, earned media placements' },
                { name: 'Campaign Management', desc: 'Paid media, ABM programs, conference activations' },
                { name: 'Strategic Advisory', desc: 'Monthly strategy sessions, market intelligence, opportunity mapping' },
                { name: 'Network Activation', desc: 'Warm intros to our freight media + industry connections' },
                { name: 'Performance Analytics', desc: 'Attribution reporting, ROI tracking, optimization recommendations' }
              ],
              outcome: 'Compounding returns. Each month builds on the last.',
              icon: '‚óà'
            }
          ];
          
          return (
            <section id="proposal" className="py-24 px-6 md:px-20 relative overflow-hidden">
              <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-neon/5 via-black to-black"></div>
              
              <div className="max-w-6xl mx-auto relative z-10">
                <SectionHeader number="04" title="The Execution Playbook" subtitle="Reverse-Engineered for Revenue" />
                
                <div className="max-w-3xl mb-16">
                  <p className="text-xl text-gray-300 mb-6 leading-relaxed">
                    Every phase is designed with one goal: <span className="text-white font-bold">accelerate the velocity at which Sensos closes new business.</span>
                  </p>
                  <p className="text-gray-400 leading-relaxed">
                    Manifest is the jungle‚Äî5,000+ decision-makers, endless noise, limited attention. 
                    Not many firms can impact both <span className="text-neon">revenue velocity</span> and <span className="text-neon">brand velocity</span> simultaneously. 
                    DWTB?! can. Here's exactly how.
                  </p>
                </div>
                
                {/* Phase Modules */}
                <div className="space-y-6">
                  {phases.map((phase, i) => (
                    <div 
                      key={phase.id}
                      className={`bg-black border transition-all duration-500 ${expandedPhase === phase.id ? 'border-neon shadow-[0_0_60px_rgba(0,255,194,0.15)]' : 'border-gray-800/50 hover:border-gray-700'}`}
                    >
                      {/* Phase Header */}
                      <div 
                        onClick={() => setExpandedPhase(expandedPhase === phase.id ? null : phase.id)}
                        className="p-6 md:p-8 cursor-pointer"
                      >
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                          <div className="flex items-start gap-4">
                            <div className={`text-3xl ${expandedPhase === phase.id ? 'text-neon' : 'text-gray-600'} transition-colors`}>
                              {phase.icon}
                            </div>
                            <div>
                              <div className="flex items-center gap-3 mb-1">
                                <span className="mono text-xs text-neon tracking-wider">{phase.phase}</span>
                                <span className="mono text-xs text-gray-600">{phase.timeline}</span>
                              </div>
                              <h3 className="text-2xl font-bold text-white mb-1">{phase.title}</h3>
                              <p className="text-gray-400">{phase.subtitle}</p>
                            </div>
                          </div>
                          
                          <div className="flex items-center gap-6">
                            <div className="text-right">
                              <div className="mono text-sm text-red-400 line-through opacity-70">{phase.agencyPrice}</div>
                              <div className="mono text-2xl text-neon font-bold">{phase.dudePrice}</div>
                            </div>
                            <div className={`w-10 h-10 rounded-full border-2 flex items-center justify-center transition-all ${expandedPhase === phase.id ? 'border-neon bg-neon text-black rotate-45' : 'border-gray-700 text-gray-500'}`}>
                              +
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      {/* Expanded Content */}
                      {expandedPhase === phase.id && (
                        <div className="border-t border-gray-800/50 p-6 md:p-8 animate-fadeIn">
                          <p className="text-lg text-gray-300 mb-8 leading-relaxed">
                            {phase.thesis}
                          </p>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            {phase.deliverables.map((item, j) => (
                              <div key={j} className="bg-black border border-gray-800/30 p-4 hover:border-neon/30 transition-colors">
                                <div className="flex items-start gap-3">
                                  <div className="w-1.5 h-1.5 bg-neon rounded-full mt-2 flex-shrink-0"></div>
                                  <div>
                                    <div className="text-white font-medium mb-1">{item.name}</div>
                                    <div className="text-sm text-gray-500">{item.desc}</div>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                          
                          <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 pt-6 border-t border-gray-800/30">
                            <div className="flex items-center gap-2">
                              <span className="mono text-xs text-gray-500">OUTCOME:</span>
                              <span className="text-neon">{phase.outcome}</span>
                            </div>
                            <div className="flex items-center gap-2 bg-green-900/20 px-3 py-1.5 rounded">
                              <span className="mono text-xs text-gray-400">YOU SAVE:</span>
                              <span className="mono text-green-400 font-bold">{phase.savings}</span>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                
                {/* Total Investment Summary */}
                <div className="mt-12 bg-black border-2 border-neon p-8 shadow-[0_0_60px_rgba(0,255,194,0.1)]">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                    <div>
                      <div className="mono text-xs text-gray-500 mb-1">AGENCY QUOTE</div>
                      <div className="mono text-2xl text-red-400 line-through opacity-70">$319,500+</div>
                      <div className="text-xs text-gray-600">(Year 1 with retainer)</div>
                    </div>
                    <div className="text-center">
                      <div className="mono text-xs text-neon mb-1">THE DUDE PRICE</div>
                      <div className="mono text-4xl text-white font-black">$90,000</div>
                      <div className="text-sm text-gray-400">+ $12K/mo retainer</div>
                    </div>
                    <div className="text-right">
                      <div className="mono text-xs text-green-400 mb-1">YEAR 1 SAVINGS</div>
                      <div className="mono text-3xl text-green-400 font-bold">$229,500+</div>
                      <div className="text-xs text-gray-500">Reinvest in growth</div>
                    </div>
                  </div>
                </div>
                
                {/* The Meta Proof */}
                <div className="mt-12 p-6 bg-black border border-gray-800/50">
                  <div className="flex items-start gap-4">
                    <div className="text-2xl">üí°</div>
                    <div>
                      <p className="text-white font-medium mb-2">Imagine This at Manifest</p>
                      <p className="text-gray-400 text-sm leading-relaxed">
                        How powerful would it be to have a site exactly like this one running at the Monolith booth‚Äî
                        accessible on every phone, every prospect's device? We can <span className="text-white">literally tie revenue back to the event</span> by 
                        powering it with HubSpot forms. Real-time attribution. Provable ROI. 
                        <span className="text-neon"> That's the Phase 2 deliverable.</span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Competitive Landscape Component - Market Intel
        const CompetitiveLandscape = () => {
          const competitors = [
            { name: 'project44', position: 'Market leader narrative', weakness: 'Commodity perception' },
            { name: 'FourKites', position: 'Enterprise focus', weakness: 'Innovation stagnation' },
            { name: 'Tive', position: 'Hardware-first', weakness: 'Software secondary' },
            { name: 'Overhaul', position: 'Security angle', weakness: 'Narrow positioning' }
          ];
          
          return (
            <section className="py-16 px-6 md:px-20 border-t border-gray-800/50">
              <div className="max-w-6xl mx-auto">
                <div className="flex items-center gap-4 mb-8">
                  <span className="mono text-xs text-neon tracking-wider">MARKET INTELLIGENCE</span>
                  <div className="flex-1 h-px bg-gray-800/50"></div>
                </div>
                
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                  <div className="lg:col-span-1">
                    <h3 className="text-2xl font-bold text-white mb-4">The Battlefield</h3>
                    <p className="text-gray-400 mb-6 leading-relaxed text-sm">
                      Visibility is a crowded space. Everyone claims AI. Everyone claims real-time. 
                      <span className="text-white">Nobody owns "agentic."</span> That's the gap.
                    </p>
                    <p className="text-gray-500 text-sm mb-6">
                      The Singularity narrative positions Sensos not as another visibility tool, 
                      but as the <span className="text-neon">moment the old rules break down</span>.
                    </p>
                    <a 
                      href="https://docs.google.com/document/d/1tAgP1DDQbuKkqzKschxu4WU0TnqwMu8lEipqii1kLcg/edit"
                      target="_blank"
                      rel="noreferrer"
                      className="inline-flex items-center gap-2 mono text-xs text-neon hover:text-white transition-colors"
                    >
                      Full Analysis ‚Üí
                    </a>
                  </div>
                  
                  <div className="lg:col-span-2">
                    <div className="grid grid-cols-2 gap-3">
                      {competitors.map((c, i) => (
                        <div key={i} className="bg-black border border-gray-800/30 p-4 hover:border-gray-700 transition-colors">
                          <div className="text-white font-medium mb-2">{c.name}</div>
                          <div className="text-xs text-gray-500 mb-1">Position: <span className="text-gray-400">{c.position}</span></div>
                          <div className="text-xs text-red-400/70">Gap: {c.weakness}</div>
                        </div>
                      ))}
                    </div>
                    <div className="mt-4 p-4 bg-neon/5 border border-neon/20">
                      <div className="flex items-center gap-2">
                        <div className="w-2 h-2 bg-neon rounded-full"></div>
                        <span className="mono text-xs text-neon">SENSOS POSITIONING</span>
                      </div>
                      <p className="text-sm text-white mt-2">"We don't just see disruptions‚Äîwe fix them before you wake up."</p>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // Social Proof Component - Why We're The Right Choice
        const SocialProof = () => {
          const capabilities = [
            { category: 'CREATIVE', items: ['WebGL Development', 'Brand Systems', 'Motion Design', 'Interactive Demos'] },
            { category: 'STRATEGY', items: ['GTM Planning', 'Messaging Architecture', 'Competitive Positioning', 'Event Activation'] },
            { category: 'MEDIA', items: ['PR Outreach', 'Earned Placements', 'Podcast Network', 'Content Engine'] },
            { category: 'NETWORK', items: ['C-Suite Intros', 'Investor Connections', 'Media Relationships', 'Industry Events'] }
          ];
          
          return (
            <section className="py-24 px-6 md:px-20 border-t border-gray-800/50 relative overflow-hidden">
              <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_var(--tw-gradient-stops))] from-neon/5 via-black to-black"></div>
              
              <div className="max-w-6xl mx-auto relative z-10">
                <SectionHeader number="05" title="Why DWTB?!" subtitle="The Right Partner for This Moment" />
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                  {/* The Case */}
                  <div>
                    <p className="text-xl text-gray-300 mb-6 leading-relaxed">
                      You're not hiring an agency. You're hiring a <span className="text-white font-bold">force multiplier</span>.
                    </p>
                    <p className="text-gray-400 mb-6 leading-relaxed">
                      50+ livestream episodes with freight tech founders. Product launches announced on our show. 
                      C-suite appointments broken first through our network. We don't just understand the industry‚Äî
                      <span className="text-neon">we're wired into it</span>.
                    </p>
                    <p className="text-gray-400 mb-8 leading-relaxed">
                      The podcast led to advisory work. Advisory led to creative. Now we do both‚Äî
                      because we learned that <span className="text-white">great tech doesn't sell itself</span>.
                    </p>
                    
                    <div className="space-y-4">
                      <div className="p-4 bg-black border-l-2 border-neon">
                        <div className="mono text-xs text-neon mb-2">THE THESIS</div>
                        <p className="text-sm text-gray-300 italic">
                          "There's a huge difference between having great tech and being able to market it."
                        </p>
                      </div>
                      
                      <div className="p-4 bg-black border border-gray-800/50 hover:border-green-500/30 transition-colors">
                        <div className="flex items-center gap-2 mb-2">
                          <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                          <span className="mono text-xs text-green-400">MARKET SIGNAL</span>
                        </div>
                        <p className="text-sm text-gray-300">
                          <span className="text-white font-semibold">Trigent</span> has approached us for the same engagement‚Äî
                          including hosting their roundtable.
                        </p>
                        <p className="text-xs text-gray-500 mt-2">The playbook works. Others are noticing.</p>
                      </div>
                    </div>
                  </div>
                  
                  {/* Capabilities Matrix */}
                  <div>
                    <div className="grid grid-cols-2 gap-3">
                      {capabilities.map((cap, i) => (
                        <div key={i} className="bg-black border border-gray-800/50 p-4 hover:border-neon/30 transition-colors">
                          <div className="mono text-xs text-neon mb-3">{cap.category}</div>
                          <div className="space-y-1.5">
                            {cap.items.map((item, j) => (
                              <div key={j} className="flex items-center gap-2 text-xs">
                                <div className="w-1 h-1 bg-gray-600 rounded-full"></div>
                                <span className="text-gray-400">{item}</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    <div className="mt-4 p-4 bg-black border border-gray-800/50">
                      <div className="flex items-center justify-between mb-3">
                        <span className="mono text-xs text-gray-500">NETWORK DEPTH</span>
                        <span className="mono text-xs text-neon">2 GENERATIONS</span>
                      </div>
                      <p className="text-xs text-gray-400">
                        FreightWaves alumni. American Shipper legacy. Podcast guests who became partners. 
                        <span className="text-white">Doors that don't open for agencies.</span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          );
        };

        // The Meta Component - When Marketing Becomes Product
        const TheMeta = () => {
          const codeSnippet = `// This proposal is built with:
const tech = {
  framework: 'React 18',
  styling: 'Tailwind CSS',
  ai: 'Gemini 2.5 Flash',
  pdf: 'jsPDF',
  deploy: 'Vercel'
};

// Real-time signature capture
const SignaturePad = () => {
  const [hasInk, setHasInk] = useState(false);
  // ... 200 lines of canvas magic
};

// AI-powered manifesto narration
const playChunk = async (index) => {
  const audio = await textToSpeech(chunk);
  // Neural voice synthesis
};`;
          
          return (
            <section className="py-24 px-6 md:px-20 border-t border-gray-800/50 relative overflow-hidden">
              <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-neon/3 via-black to-black"></div>
              
              <div className="max-w-6xl mx-auto relative z-10">
                <div className="text-center mb-12">
                  <div className="mono text-xs text-neon tracking-[0.3em] mb-4">RECURSIVE PROOF</div>
                  <h2 className="text-4xl md:text-5xl font-black text-white mb-4 leading-tight">
                    This Proposal Is The Demo.
                  </h2>
                  <p className="text-gray-400 max-w-2xl mx-auto">
                    Everything you're experiencing right now‚Äîthe interactions, the AI, the signature workflow‚Äî
                    this is what we build for the booth.
                  </p>
                </div>
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                  {/* The Argument */}
                  <div className="bg-black border border-gray-800/50 p-8">
                    <p className="text-lg text-gray-300 mb-6 leading-relaxed">
                      Look at what you're interacting with. A void that responds to your presence. 
                      AI-powered narration. Legal-grade PDF generation. 
                      <span className="text-white">This isn't a pitch deck‚Äîit's proof of concept.</span>
                    </p>
                    
                    <p className="text-gray-400 mb-6 leading-relaxed">
                      DWTB?! builds demos that win hearts and minds at the booth. 
                      <span className="text-neon">And</span> we deliver the marketing that sells the product. 
                      Most shops do one or the other. We do both.
                    </p>
                    
                    <div className="p-4 bg-black border-l-2 border-neon">
                      <div className="mono text-xs text-neon mb-2">THE PROVOCATIVE QUESTION</div>
                      <p className="text-sm text-gray-300 italic leading-relaxed">
                        "If the sales pitch is embedded in a high-tech psychological mechanism... 
                        when does marketing stop being marketing and start being a product?"
                      </p>
                    </div>
                  </div>
                  
                  {/* The Code */}
                  <div className="bg-black border border-gray-800/50 overflow-hidden">
                    <div className="p-3 border-b border-gray-800/50 flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <div className="w-3 h-3 rounded-full bg-red-500"></div>
                        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                      </div>
                      <span className="mono text-xs text-gray-500">proposal.jsx</span>
                    </div>
                    <pre className="p-4 text-xs overflow-x-auto">
                      <code className="text-gray-400">
                        {codeSnippet.split('\n').map((line, i) => (
                          <div key={i} className="flex">
                            <span className="text-gray-600 w-6 flex-shrink-0 select-none">{i + 1}</span>
                            <span className={line.includes('//') ? 'text-gray-500' : line.includes('const') || line.includes('async') ? 'text-purple-400' : line.includes("'") ? 'text-neon' : 'text-gray-300'}>
                              {line}
                            </span>
                          </div>
                        ))}
                      </code>
                    </pre>
                  </div>
                </div>
                
                {/* Disruption Simulator - The Live Demo */}
                <div className="mb-8">
                  <div className="text-center mb-6">
                    <div className="mono text-xs text-gray-500 mb-2">TRY IT NOW</div>
                    <p className="text-sm text-gray-400">This is what runs at the booth. Test LIA's brain.</p>
                  </div>
                  <DisruptionSimulator />
                </div>
                
                <div className="text-center">
                  <p className="text-sm text-neon">
                    The answer to the question is already in front of you.
                  </p>
                </div>
              </div>
            </section>
          );
        };

        // Digital Signature Pad Component
        const SignaturePad = () => {
          const canvasRef = useRef(null);
          const previewRef = useRef(null);
          const [enabled, setEnabled] = useState(true);
          const [hasInk, setHasInk] = useState(false);
          const [dataUrl, setDataUrl] = useState("");
          const [drawing, setDrawing] = useState(false);
          const lastRef = useRef({ x: 0, y: 0 });

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';

            const getPos = (evt) => {
              const rect = canvas.getBoundingClientRect();
              const clientX = evt.clientX ?? (evt.touches && evt.touches[0].clientX);
              const clientY = evt.clientY ?? (evt.touches && evt.touches[0].clientY);
              return { x: clientX - rect.left, y: clientY - rect.top };
            };

            const start = (evt) => { evt.preventDefault(); setDrawing(true); lastRef.current = getPos(evt); };
            const move = (evt) => {
              if (!drawing) return; evt.preventDefault();
              const p = getPos(evt);
              ctx.beginPath(); ctx.moveTo(lastRef.current.x, lastRef.current.y); ctx.lineTo(p.x, p.y); ctx.stroke();
              lastRef.current = p; setHasInk(true);
            };
            const end = (evt) => { if (!drawing) return; evt.preventDefault(); setDrawing(false); };

            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('mousemove', move);
            window.addEventListener('mouseup', end);
            canvas.addEventListener('touchstart', start, { passive: false });
            canvas.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('touchend', end, { passive: false });

            const cleanup = () => {
              canvas.removeEventListener('mousedown', start);
              canvas.removeEventListener('mousemove', move);
              window.removeEventListener('mouseup', end);
              canvas.removeEventListener('touchstart', start, { passive: false });
              canvas.removeEventListener('touchmove', move, { passive: false });
              window.removeEventListener('touchend', end, { passive: false });
            };
            return cleanup;
          }, [drawing]);

          useEffect(() => {
            // responsive CSS sizing while keeping internal resolution
            const canvas = canvasRef.current;
            const section = canvas?.parentElement;
            const resize = () => {
              if (!canvas || !section) return;
              const baseW = 640, baseH = 240;
              const maxW = Math.min(baseW, section.clientWidth - 4);
              const scale = maxW / baseW;
              canvas.style.width = `${maxW}px`;
              canvas.style.height = `${baseH * scale}px`;
            };
            window.addEventListener('resize', resize);
            resize();
            return () => window.removeEventListener('resize', resize);
          }, []);

          const clear = () => {
            const canvas = canvasRef.current; if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            setHasInk(false); setDataUrl("");
            if (previewRef.current) previewRef.current.src = "";
          };

          const save = () => {
            const canvas = canvasRef.current; if (!canvas) return;
            if (!hasInk) { alert('Please add a signature before saving.'); return; }
            const url = canvas.toDataURL('image/png');
            setDataUrl(url);
            if (previewRef.current) previewRef.current.src = url;
            notifyEvent('signature_saved', { bytes: url.length });
          };

          const exportPng = () => {
            if (!dataUrl) return;
            const a = document.createElement('a');
            a.href = dataUrl; a.download = 'signature.png';
            a.click();
            notifyEvent('signature_downloaded');
          };

          return (
            <div>
              <label className="flex items-center gap-2 mb-4 cursor-pointer">
                <input type="checkbox" checked={enabled} onChange={() => { setEnabled(v => !v); if (enabled) clear(); }} />
                <span className="mono text-xs text-gray-400">Add Digital Signature</span>
              </label>
              {!enabled ? (
                <div className="text-gray-600 text-sm">Toggle to enable signature pad.</div>
              ) : (
                <div>
                  <canvas ref={canvasRef} width={640} height={240} className="w-full bg-black border border-gray-800/50 rounded-lg" aria-label="Signature pad"></canvas>
                  <div className="flex gap-3 mt-3">
                    <button onClick={clear} className="px-4 py-2 bg-black text-white rounded hover:bg-gray-900 border border-gray-700">Clear</button>
                    <button onClick={save} className="px-4 py-2 bg-neon text-black font-bold rounded hover:bg-white">Save Signature</button>
                    <button onClick={exportPng} disabled={!dataUrl} className="px-4 py-2 bg-black text-white border border-gray-700 rounded disabled:opacity-50 hover:border-neon">Download Signature</button>
                  </div>
                  <div className="mt-4">
                    <div className="mono text-xs text-gray-500 mb-2">Saved signature preview:</div>
                    <img ref={previewRef} alt="Saved signature preview" className="max-w-full h-auto border border-gray-800 rounded" />
                  </div>
                  <input type="hidden" name="signatureData" value={dataUrl} />
                </div>
              )}
            </div>
          );
        };

        const ApiKeyModal = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [key, setKey] = useState("");

            useEffect(() => {
                if (!getApiKey()) {
                    const timer = setTimeout(() => setIsOpen(true), 2000); // Prompt after 2s if missing
                    return () => clearTimeout(timer);
                }
            }, []);

            const saveKey = () => {
                if (key) {
                    localStorage.setItem('gemini_api_key', key);
                    setIsOpen(false);
                    window.location.reload(); // Reload to ensure everything picks it up
                }
            };

            if (!isOpen) return (
                <button onClick={() => setIsOpen(true)} className="fixed bottom-4 left-4 z-50 bg-black text-gray-500 p-2 rounded-full hover:text-neon border border-gray-800/50 hover:border-neon transition-colors">
                    <ShieldAlert size={16} />
                </button>
            );

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">
                    <div className="bg-black border border-neon p-8 rounded-xl max-w-md w-full shadow-[0_0_50px_rgba(0,255,194,0.2)]">
                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <ShieldAlert className="text-neon" /> SECURITY CLEARANCE
                        </h3>
                        <p className="text-gray-400 text-sm mb-6">
                            This terminal requires a Gemini API Key for neural processing. 
                            The key is stored locally in your browser (localStorage) and never sent to our servers.
                        </p>
                        <input 
                            type="password" 
                            value={key}
                            onChange={(e) => setKey(e.target.value)}
                            placeholder="Paste Gemini API Key"
                            className="w-full bg-black border border-gray-700 p-3 text-white font-mono mb-4 focus:border-neon outline-none"
                        />
                        <div className="flex justify-end gap-4">
                            <button onClick={() => setIsOpen(false)} className="text-gray-500 hover:text-white text-sm">CANCEL</button>
                            <button onClick={saveKey} className="bg-neon text-black font-bold px-6 py-2 hover:bg-white transition-colors">
                                AUTHENTICATE
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Manifesto Reader (top-level, before App)
        function ManifestoReader() {
          const [open, setOpen] = useState(false);
          const [activeIndex, setActiveIndex] = useState(-1);
          const [audioCache, setAudioCache] = useState({});
          const [isLoading, setIsLoading] = useState(false);
          const [isPlaying, setIsPlaying] = useState(false);
          const [skipAudio, setSkipAudio] = useState(false);
          const itemRefs = useRef([]);
          const audioRef = useRef(new Audio());
          const advanceTimerRef = useRef(null);

          const manifestoChunks = [
            "The supply chain isn't broken. It's obsolete.",
            "Legacy visibility watches disasters happen. LIA intervenes before they exist.",
            "We are not a better dashboard. We are a central nervous system.",
            "Exceptions are not alerts. They are orders for the brain to act.",
            "Control beats visibility. Outcomes beat metrics.",
            "Sensos needs a weapon, not a brochure.",
            "This is logistics with agency. The freight moves because the brain wills it.",
            "If data is the terrain, LIA is the force that crosses it.",
            "We don't report on fires. We extinguish them before you smell smoke.",
            "The Monolith is not a booth. It's a threshold.",
            "Sign the contract. Join the divergence.",
          ];

          useEffect(() => {
            const handler = () => setOpen(true);
            window.addEventListener('open-manifesto-reader', handler);
            return () => window.removeEventListener('open-manifesto-reader', handler);
          }, []);

          const getAudioForChunk = async (index) => {
            if (index >= manifestoChunks.length) return null;
            if (audioCache[index]) return audioCache[index];
            const text = manifestoChunks[index];
            try {
              const b64 = await generateSpeech(text);
              if (!b64) return null;
              const wav = base64ToWav(b64);
              const url = URL.createObjectURL(wav);
              setAudioCache(prev => ({ ...prev, [index]: url }));
              return url;
            } catch (e) {
              console.error('TTS error:', e);
              return null;
            }
          };

          const playChunk = async (index) => {
            // Clear any pending advance timer
            if (advanceTimerRef.current) {
              clearTimeout(advanceTimerRef.current);
              advanceTimerRef.current = null;
            }
            
            if (index >= manifestoChunks.length) {
              setIsPlaying(false);
              setIsLoading(false);
              notifyEvent('manifesto_complete');
              return;
            }
            
            setActiveIndex(index);
            notifyEvent('manifesto_chunk_play', { index });
            
            if (itemRefs.current[index]) {
              itemRefs.current[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // If skipping audio, just advance after delay
            if (skipAudio) {
              advanceTimerRef.current = setTimeout(() => playChunk(index + 1), 3000);
              return;
            }
            
            // Try to get and play audio
            setIsLoading(true);
            let audioUrl = audioCache[index];
            if (!audioUrl) {
              audioUrl = await getAudioForChunk(index);
              // Pre-fetch next chunk
              getAudioForChunk(index + 1);
            }
            setIsLoading(false);
            
            if (audioUrl) {
              try {
                audioRef.current.src = audioUrl;
                audioRef.current.onerror = () => {
                  console.warn('Audio playback error, advancing...');
                  advanceTimerRef.current = setTimeout(() => playChunk(index + 1), 3000);
                };
                audioRef.current.onended = () => {
                  notifyEvent('manifesto_chunk_end', { index });
                  playChunk(index + 1);
                };
                await audioRef.current.play();
              } catch (e) {
                console.warn('Play failed:', e);
                // Autoplay blocked or other error - advance anyway
                advanceTimerRef.current = setTimeout(() => playChunk(index + 1), 3000);
              }
            } else {
              // No audio available, advance after reading time
              advanceTimerRef.current = setTimeout(() => playChunk(index + 1), 3000);
            }
          };

          const startExperience = () => {
            setIsPlaying(true);
            setActiveIndex(-1);
            notifyEvent('manifesto_start');
            playChunk(0);
          };

          const stopExperience = () => {
            if (advanceTimerRef.current) clearTimeout(advanceTimerRef.current);
            audioRef.current.pause();
            setIsPlaying(false);
            setOpen(false);
            notifyEvent('manifesto_terminated');
            window.dispatchEvent(new CustomEvent('manifesto-closed-scroll'));
          };
          
          const manualAdvance = () => {
            if (advanceTimerRef.current) clearTimeout(advanceTimerRef.current);
            audioRef.current.pause();
            playChunk(activeIndex + 1);
          };

          if (!open) return null;
          return (
            <div className="fixed inset-0 z-[120] bg-black flex flex-col">
              <div className="p-4 border-b border-gray-800 flex justify-between items-center bg-black/90 backdrop-blur z-10">
                <div className="flex items-center gap-3">
                  <div className={`w-3 h-3 rounded-full ${isPlaying ? 'bg-red-500 animate-pulse' : 'bg-gray-500'}`}></div>
                  <span className="mono text-neon text-sm">LIA // MANIFESTO PROTOCOL</span>
                  {isLoading && <span className="mono text-xs text-yellow-400 animate-pulse">Loading audio...</span>}
                </div>
                <div className="flex items-center gap-3">
                  <label className="flex items-center gap-2 text-xs text-gray-400 cursor-pointer">
                    <input type="checkbox" checked={skipAudio} onChange={(e) => setSkipAudio(e.target.checked)} className="accent-neon" />
                    <span>Skip Audio</span>
                  </label>
                  {activeIndex >= 0 && activeIndex < manifestoChunks.length - 1 && (
                    <button onClick={manualAdvance} className="px-3 py-1 bg-black text-white text-xs rounded hover:bg-neon hover:text-black border border-gray-700 transition-colors">Next ‚Üí</button>
                  )}
                  {activeIndex === -1 ? (
                    <button onClick={startExperience} className="px-3 py-1 bg-neon text-black font-bold text-xs">INITIATE</button>
                  ) : (
                    <button onClick={stopExperience} className="text-gray-400 hover:text-white text-xs">Close</button>
                  )}
                </div>
              </div>
              <div className="flex-1 overflow-y-auto relative p-8 md:p-20 scroll-smooth">
                <div className="max-w-4xl mx-auto space-y-24 py-10">
                  {activeIndex === -1 && (
                    <div className="h-[50vh] flex flex-col items-center justify-center text-center">
                      <h2 className="text-5xl md:text-7xl font-black text-white mb-8 uppercase tracking-tighter">
                        The <span className="text-neon">Truth</span>
                      </h2>
                      <button onClick={startExperience} className="px-6 py-3 bg-neon text-black font-bold uppercase tracking-widest">Initiate Sequence</button>
                    </div>
                  )}
                  {manifestoChunks.map((text, i) => (
                    <div key={i} ref={el => itemRefs.current[i] = el} className={`transition-all duration-700 ${i === activeIndex ? 'opacity-100 scale-105 blur-none' : 'opacity-25 scale-95 blur-[2px]'}`}>
                      <p className={`text-3xl md:text-5xl font-bold leading-tight uppercase ${i === activeIndex ? 'text-white text-shadow-neon' : 'text-gray-600'}`}>
                        {i === activeIndex && <span className="text-neon mr-3">&gt;</span>}
                        {text}
                      </p>
                    </div>
                  ))}
                  {activeIndex >= manifestoChunks.length - 1 && (
                    <div className="h-[40vh] flex items-center justify-center">
                      <button onClick={() => { stopExperience(); window.dispatchEvent(new CustomEvent('open-real-review-sign-portal')); }} className="text-neon border border-neon px-8 py-4 uppercase hover:bg-neon hover:text-black transition-colors">Proceed to Signature</button>
                    </div>
                  )}
                </div>
              </div>
              <div className="pointer-events-none absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-[50] bg-[length:100%_2px,3px_100%]"></div>
            </div>
          );
        }

        // Main App Component
        function App() {
          // Countdown to Monday 12/15/2025 midnight ET (05:00:00Z)
          const DEADLINE_TS = Date.parse('2025-12-15T05:00:00Z');
          const [remaining, setRemaining] = useState(Math.max(0, DEADLINE_TS - Date.now()));
          const [expired, setExpired] = useState(DEADLINE_TS - Date.now() <= 0);
          const [signed, setSigned] = useState(!!localStorage.getItem('sow_signed_at'));
          // Notify when signature section enters viewport
          useEffect(() => {
            const el = document.getElementById('sign');
            if (!el) return;
            const obs = new IntersectionObserver((entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  notifyEvent('view_signature_section');
                }
              });
            }, { threshold: 0.5 });
            obs.observe(el);
            return () => obs.disconnect();
          }, []);

          // Heartbeat ping and UI health checks
          useEffect(() => {
            const ping = () => notifyEvent('heartbeat');
            const checkUi = () => {
              const fixed = document.querySelector('.fixed.bottom-0');
              const sign = document.getElementById('sign');
              const canvas = sign?.querySelector('canvas');
              const saveBtn = sign?.querySelector('button:nth-of-type(2)');
              if (!fixed || !sign || !canvas || !saveBtn) {
                notifyEvent('ui_missing', {
                  fixed: !!fixed,
                  sign: !!sign,
                  canvas: !!canvas,
                  saveBtn: !!saveBtn,
                });
              }
            };
            // initial and interval
            ping();
            checkUi();
            const pingId = setInterval(ping, 60 * 1000); // every 1 min
            const checkId = setInterval(checkUi, 60 * 1000);
            return () => { clearInterval(pingId); clearInterval(checkId); };
          }, []);
          // Countdown ticker
          useEffect(() => {
            if (signed || expired) return;
            const tick = () => {
              const rem = DEADLINE_TS - Date.now();
              setRemaining(Math.max(0, rem));
              if (rem <= 0) {
                setExpired(true);
                notifyEvent('offer_expired', { deadlineET: '2025-12-15T00:00:00-05:00' });
              }
            };
            tick();
            const id = setInterval(tick, 1000);
            return () => clearInterval(id);
          }, [signed, expired]);
          // Notify when webhook configured
          useEffect(() => {
            const url = getNotifyUrl();
            if (url) {
              notifyEvent('notify_connected');
            }
          }, []);
          // Auto-scroll to sign section after manifesto closes
          useEffect(() => {
            const handler = () => {
              setTimeout(() => {
                const el = document.getElementById('review-sign');
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }, 300);
            };
            window.addEventListener('manifesto-closed-scroll', handler);
            return () => window.removeEventListener('manifesto-closed-scroll', handler);
          }, []);

          return (
            <div className="bg-black text-white min-h-screen">
              <style>{styles}</style>
              <div className="scanline"></div>
              <ApiKeyModal />
              <FloatingPodcast />
              <Hero />
              <TheProblem />
              <Strategy />
              <CompetitiveEdge />
              <ExecutionPlaybook />
              <CompetitiveLandscape />
              <SocialProof />
              <TheMeta />
              <ManifestPlan />
              <ManifestoExperience />
              <FixedCTA remaining={remaining} expired={expired} signed={signed} />
              <NotifyModal />
              <ManifestoReader />
              <ToastHost />
              <ExitIntentModal />
              <ConfettiCelebration />
              <ReviewSignPortal deadlineTs={DEADLINE_TS} expired={expired} setSigned={setSigned} />
            </div>
          );
        }

        // Notifications configuration modal
        const NotifyModal = () => {
          const [open, setOpen] = useState(false);
          const [url, setUrl] = useState("");
          const [connected, setConnected] = useState(!!getNotifyUrl());

          useEffect(() => {
            setUrl(getNotifyUrl() || "");
          }, []);

          const save = () => {
            if (url) {
              localStorage.setItem('notify_url', url);
              setConnected(true);
              window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'Webhook connected.' } }));
              notifyEvent('notify_saved', { url });
              setOpen(false);
            }
          };

          const test = () => {
            notifyEvent('notify_test', { example: 'hello' }, { interactive: true });
          };

          return (
            <>
              <button onClick={() => setOpen(true)} className="fixed bottom-16 left-4 z-50 bg-black text-gray-500 px-3 py-2 rounded-full hover:text-neon border border-gray-800/50 hover:border-neon transition-colors">
                {connected ? 'Notifications: On' : 'Notifications: Off'}
              </button>
              {!open ? null : (
                <div className="fixed inset-0 z-[130] flex items-center justify-center bg-black/80 backdrop-blur-sm">
                  <div className="bg-black border border-neon p-6 rounded-xl w-full max-w-md">
                    <h3 className="text-white font-bold mb-3">Notifications Webhook</h3>
                    <p className="text-gray-400 text-sm mb-4">Paste a webhook URL (e.g., webhook.site). Events will be sent silently.</p>
                    <input value={url} onChange={(e) => setUrl(e.target.value)} placeholder="https://..." className="w-full bg-black border border-gray-700 p-2 text-white" />
                    <div className="flex justify-end gap-2 mt-4">
                      <button onClick={() => setOpen(false)} className="text-gray-400">Cancel</button>
                      <button onClick={test} className="px-3 py-1 bg-black text-white border border-gray-700 hover:border-neon transition-colors">Send Test</button>
                      <button onClick={save} className="px-3 py-1 bg-neon text-black font-bold">Save</button>
                    </div>
                  </div>
                </div>
              )}
            </>
          );
        };

        // Manifesto Gate (modal)
        const ManifestoGate = () => {
          const [open, setOpen] = useState(false);
          const docId = '1r6HGpR1DKIcxUtr-xyyLTzuDrhqIhaIQ';
          const docUrl = `https://drive.google.com/file/d/${docId}/preview`;
          useEffect(() => {
            const handler = () => setOpen(true);
            window.addEventListener('open-manifesto-gate', handler);
            return () => window.removeEventListener('open-manifesto-gate', handler);
          }, []);
          if (!open) return null;
          const continueFlow = () => {
            setOpen(false);
            notifyEvent('manifesto_reviewed', {}, { interactive: true });
            window.dispatchEvent(new CustomEvent('open-real-review-sign-portal'));
          };
          return (
            <div className="fixed inset-0 z-[120] bg-black/85 backdrop-blur-sm flex items-center justify-center p-4">
              <div className="bg-black border border-neon w-full max-w-5xl">
                <div className="flex items-center justify-between p-4 border-b border-gray-800">
                  <h3 className="text-white font-bold uppercase">The Plan / Manifesto</h3>
                  <button onClick={() => setOpen(false)} className="text-gray-400 hover:text-white text-xs">Close</button>
                </div>
                <div className="p-4">
                  <div className="h-[70vh] relative bg-black border border-neon shadow-[0_0_30px_rgba(0,255,194,0.15)] overflow-hidden">
                    <div className="absolute inset-0 pointer-events-none opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                    <iframe title="Manifesto" src={docUrl} className="w-full h-full grayscale-[10%] contrast-110"/>
                    <div className="absolute inset-x-0 top-0 h-16 bg-gradient-to-b from-black/80 to-transparent"></div>
                    <div className="absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-black/80 to-transparent"></div>
                  </div>
                  <div className="flex justify-between items-center mt-4">
                    <span className="mono text-xs text-neon">Step 1 of 2: Review the manifesto</span>
                    <button onClick={continueFlow} className="px-4 py-2 bg-neon text-black font-bold rounded hover:bg-white">Continue to Review & Sign</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Simple toast host
        const ToastHost = () => {
          const [msg, setMsg] = useState("");
          useEffect(() => {
            const handler = (e) => {
              setMsg(e.detail?.message || "");
              clearTimeout(window.__toastTimer);
              window.__toastTimer = setTimeout(() => setMsg(""), 2500);
            };
            window.addEventListener('toast', handler);
            return () => window.removeEventListener('toast', handler);
          }, []);
          if (!msg) return null;
          return (
            <div className="fixed bottom-6 right-6 z-[200]">
              <div className="px-4 py-2 bg-black/80 text-white border border-neon shadow-[0_0_20px_rgba(0,255,194,0.2)] rounded mono text-xs">
                {msg}
              </div>
            </div>
          );
        };

        // Exit Intent Modal
        const ExitIntentModal = () => {
          const [show, setShow] = useState(false);
          const [dismissed, setDismissed] = useState(false);
          useEffect(() => {
            if (dismissed || localStorage.getItem('exit_intent_dismissed')) return;
            const handler = (e) => {
              if (e.clientY <= 5 && !show && !dismissed) {
                setShow(true);
                notifyEvent('exit_intent_triggered');
              }
            };
            document.addEventListener('mouseout', handler);
            return () => document.removeEventListener('mouseout', handler);
          }, [show, dismissed]);
          const dismiss = () => {
            setShow(false);
            setDismissed(true);
            localStorage.setItem('exit_intent_dismissed', 'true');
          };
          const stayAndSign = () => {
            dismiss();
            notifyEvent('exit_intent_stayed');
            window.dispatchEvent(new CustomEvent('open-manifesto-reader'));
          };
          if (!show) return null;
          return (
            <div className="fixed inset-0 z-[150] bg-black/90 backdrop-blur-md flex items-center justify-center p-4">
              <div className="bg-black border-2 border-red-500 p-8 max-w-md w-full text-center shadow-[0_0_60px_rgba(255,42,0,0.3)]">
                <div className="text-6xl mb-4">‚ö†Ô∏è</div>
                <h3 className="text-2xl font-black text-white uppercase mb-2">Wait!</h3>
                <p className="text-gray-300 mb-4">You're about to leave without reviewing the proposal.</p>
                <div className="bg-green-900/30 border border-green-500/50 p-3 rounded mb-6">
                  <span className="text-green-400 font-bold text-lg">$229,500+ in Year 1 savings</span>
                  <span className="text-gray-400 text-sm block">waiting for your signature</span>
                </div>
                <div className="flex flex-col gap-3">
                  <button onClick={stayAndSign} className="w-full py-3 bg-neon text-black font-bold uppercase pulse-glow mobile-touch-target">Review & Sign Now</button>
                  <button onClick={dismiss} className="text-gray-500 text-sm hover:text-white">No thanks, I'll pass on $229K savings</button>
                </div>
              </div>
            </div>
          );
        };

        // Confetti Celebration
        const ConfettiCelebration = () => {
          const [pieces, setPieces] = useState([]);
          useEffect(() => {
            const handler = () => {
              const colors = ['#00FFC2', '#FF2A00', '#FFD700', '#FF69B4', '#00BFFF', '#FFFFFF'];
              const newPieces = Array.from({ length: 50 }, (_, i) => ({
                id: i,
                left: Math.random() * 100,
                color: colors[Math.floor(Math.random() * colors.length)],
                delay: Math.random() * 0.5,
                size: Math.random() * 8 + 6,
              }));
              setPieces(newPieces);
              setTimeout(() => setPieces([]), 3500);
            };
            window.addEventListener('confetti', handler);
            return () => window.removeEventListener('confetti', handler);
          }, []);
          return (
            <>
              {pieces.map(p => (
                <div
                  key={p.id}
                  className="confetti-piece"
                  style={{
                    left: `${p.left}%`,
                    backgroundColor: p.color,
                    width: `${p.size}px`,
                    height: `${p.size}px`,
                    animationDelay: `${p.delay}s`,
                    borderRadius: Math.random() > 0.5 ? '50%' : '0',
                  }}
                />
              ))}
            </>
          );
        };

        // Progress Breadcrumb
        const ProgressBreadcrumb = ({ step }) => {
          const steps = ['Review', 'Sign', 'Done'];
          return (
            <div className="flex items-center gap-2 mb-4">
              {steps.map((s, i) => (
                <React.Fragment key={s}>
                  <div className={`flex items-center gap-1 ${i < step ? 'text-neon' : i === step ? 'text-white' : 'text-gray-600'}`}>
                    <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${i < step ? 'bg-neon text-black' : i === step ? 'bg-white text-black' : 'bg-gray-800 text-gray-500'}`}>
                      {i < step ? '‚úì' : i + 1}
                    </span>
                    <span className="mono text-xs hidden sm:inline">{s}</span>
                  </div>
                  {i < steps.length - 1 && <div className={`w-8 h-0.5 ${i < step ? 'bg-neon' : 'bg-gray-800'}`}></div>}
                </React.Fragment>
              ))}
            </div>
          );
        };

        // Trust Badge
        const TrustBadge = () => (
          <div className="flex items-center gap-2 text-gray-400 text-xs mt-3 p-2 bg-black/50 rounded border border-gray-800/50">
            <ShieldAlert size={14} className="text-neon" />
            <span>Secure ‚Ä¢ Confidential ‚Ä¢ No commitment until signed</span>
          </div>
        );

        // TL;DR Summary Card
        const TLDRSummary = () => (
          <div className="bg-black border border-gray-800/50 p-4 rounded-lg mb-6">
            <div className="flex items-center gap-2 mb-3">
              <Zap size={16} className="text-neon" />
              <span className="mono text-xs text-neon uppercase">TL;DR ‚Äî 30 Second Summary</span>
            </div>
            <ul className="space-y-2 text-sm text-gray-300">
              <li className="flex items-start gap-2"><span className="text-neon">‚Üí</span> Rebrand + WebGL site: <span className="text-neon font-bold">$75K</span> <span className="text-red-400 line-through text-xs">$111K</span> <span className="text-green-400 text-xs">(-$36.5K)</span></li>
              <li className="flex items-start gap-2"><span className="text-neon">‚Üí</span> Manifest booth design: <span className="text-neon font-bold">$15K</span> <span className="text-red-400 line-through text-xs">$58K</span> <span className="text-green-400 text-xs">(-$43K)</span></li>
              <li className="flex items-start gap-2"><span className="text-neon">‚Üí</span> Monthly retainer: <span className="text-neon font-bold">$12K/mo</span> <span className="text-red-400 line-through text-xs">$24.5K</span> <span className="text-green-400 text-xs">(-$12.5K/mo)</span></li>
              <li className="flex items-start gap-2 pt-2 border-t border-gray-700 mt-2">
                <span className="text-green-400">üí∞</span>
                <div>
                  <span className="text-green-400 font-bold">Year 1 Savings: $229,500+</span>
                  <span className="text-gray-500 text-xs block">($79.5K upfront + $150K retainer savings)</span>
                </div>
              </li>
            </ul>
          </div>
        );


        // Review & Sign Portal (modal)
        const ReviewSignPortal = ({ deadlineTs, expired, setSigned }) => {
          const [open, setOpen] = React.useState(false);
          const nameRef = useRef(null);
          const titleRef = useRef(null);
          const emailRef = useRef(null);
          const companyRef = useRef(null);
          const canvasRef = useRef(null);
          const [hasInk, setHasInk] = useState(false);
          const [pdfBlob, setPdfBlob] = useState(null);
          const [canSend, setCanSend] = useState(false);
          const docId = '1xruZfOiLhtGaJRXBsfyowWob0Hn808oy';
          const docUrl = `https://docs.google.com/document/d/${docId}/preview`;
          const pdfUrl = `https://docs.google.com/document/d/${docId}/export?format=pdf`;
          const [now, setNow] = useState(Date.now());
          useEffect(() => {
            if (!open) return;
            const id = setInterval(() => setNow(Date.now()), 1000);
            return () => clearInterval(id);
          }, [open]);

          useEffect(() => {
            const openHandler = () => setOpen(true);
            window.addEventListener('open-real-review-sign-portal', openHandler);
            return () => window.removeEventListener('open-real-review-sign-portal', openHandler);
          }, []);

          useEffect(() => {
            if (!open) return;
            const canvas = canvasRef.current; if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2; ctx.lineJoin = 'round'; ctx.lineCap = 'round';
            let drawing = false; let last = { x:0, y:0 };
            const getPos = e => {
              const rect = canvas.getBoundingClientRect();
              const t = e.touches ? e.touches[0] : e;
              return { x: t.clientX - rect.left, y: t.clientY - rect.top };
            };
            const start = e => { e.preventDefault(); drawing = true; last = getPos(e); };
            const move = e => {
              if (!drawing) return;
              const pos = getPos(e);
              ctx.beginPath(); ctx.moveTo(last.x, last.y); ctx.lineTo(pos.x, pos.y); ctx.stroke();
              last = pos; setHasInk(true);
            };
            const end = () => { drawing = false; };
            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('mousemove', move);
            canvas.addEventListener('mouseup', end);
            canvas.addEventListener('mouseleave', end);
            canvas.addEventListener('touchstart', start, { passive: false });
            canvas.addEventListener('touchmove', move, { passive: false });
            canvas.addEventListener('touchend', end);
            return () => {
              canvas.removeEventListener('mousedown', start);
              canvas.removeEventListener('mousemove', move);
              canvas.removeEventListener('mouseup', end);
              canvas.removeEventListener('mouseleave', end);
              canvas.removeEventListener('touchstart', start);
              canvas.removeEventListener('touchmove', move);
              canvas.removeEventListener('touchend', end);
            };
          }, [open]);

          const clearSig = () => {
            const canvas = canvasRef.current; if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            setHasInk(false);
          };

          const sendPdfEmail = async () => {
            if (!pdfBlob) return;
            const email = emailRef.current?.value || '';
            if (!email) { alert('Please enter your email'); return; }
            const reader = new FileReader();
            reader.onload = () => {
              const base64 = reader.result.split(',')[1];
              window.dispatchEvent(new CustomEvent('toast', { detail: { message: `PDF ready! In production this would email to ${email}` } }));
            };
            reader.readAsDataURL(pdfBlob);
          };

          const submit = async () => {
            if (expired) return;
            const name = nameRef.current?.value || '';
            const title = titleRef.current?.value || '';
            const email = emailRef.current?.value || '';
            const company = companyRef.current?.value || '';
            const agreed = document.getElementById('agreeTerms')?.checked;
            if (!name || !email) { alert('Please fill in name and email.'); return; }
            if (!hasInk) { alert('Please sign before submitting.'); return; }
            if (!agreed) { alert('Please agree to the terms.'); return; }
            const canvas = canvasRef.current;
            const sigDataUrl = canvas.toDataURL('image/png');
            const signedAt = new Date().toISOString();
            
            // Generate integrity hash
            const integrityHash = await hashString(`${SOW_DOC_ID}|${SOW_VERSION}|${name}|${email}|${signedAt}`);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20); 
            doc.setTextColor(0, 255, 194);
            doc.text('SENSOS x MANIFEST 2026', 20, 20);
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            doc.text('Statement of Work ‚Äî Execution Agreement', 20, 30);
            
            // Horizontal line
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 35, 190, 35);
            
            // Signer details
            doc.setFontSize(11);
            doc.text('SIGNATORY INFORMATION', 20, 45);
            doc.setFontSize(10);
            doc.text(`Name: ${name}`, 20, 55);
            if (title) doc.text(`Title: ${title}`, 20, 62);
            doc.text(`Email: ${email}`, 20, title ? 69 : 62);
            if (company) doc.text(`Company: ${company}`, 20, title ? 76 : 69);
            
            // Agreement reference
            const yPos = title && company ? 90 : title || company ? 83 : 76;
            doc.setFontSize(11);
            doc.text('AGREEMENT REFERENCE', 20, yPos);
            doc.setFontSize(9);
            doc.text(`SOW Document ID: ${SOW_DOC_ID}`, 20, yPos + 8);
            doc.text(`SOW Version: ${SOW_VERSION}`, 20, yPos + 14);
            doc.text(`View SOW: https://docs.google.com/document/d/${SOW_DOC_ID}`, 20, yPos + 20);
            
            // Integrity verification
            doc.setFontSize(11);
            doc.text('DOCUMENT INTEGRITY', 20, yPos + 35);
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Integrity Hash (SHA-256): ${integrityHash}`, 20, yPos + 43);
            doc.text('This hash verifies the signer agreed to the unaltered original SOW.', 20, yPos + 49);
            doc.setTextColor(0, 0, 0);
            
            // Signature
            doc.setFontSize(11);
            doc.text('DIGITAL SIGNATURE', 20, yPos + 62);
            doc.text(`Signed: ${signedAt}`, 20, yPos + 70);
            doc.addImage(sigDataUrl, 'PNG', 20, yPos + 75, 80, 30);
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('This document was digitally signed via the Sensos proposal portal.', 20, 280);
            doc.text('Both parties have received a copy. No countersignature required.', 20, 285);
            
            const pdfBlob = doc.output('blob');
            const pdfBase64 = doc.output('datauristring').split(',')[1];
            
            setPdfBlob(pdfBlob);
            setCanSend(true);
            
            // Send to both Casey and signer
            window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'üìß Sending agreement to you and Casey...' } }));
            
            try {
              await sendSignedAgreement({
                name, email, title, company, signedAt,
                signatureDataUrl: sigDataUrl,
                pdfBase64
              });
              
              // Store signature locally
              localStorage.setItem('sow_signed_at', signedAt);
              localStorage.setItem('sow_signer_email', email);
              localStorage.setItem('sow_integrity_hash', integrityHash);
              
              setSigned(true);
              setOpen(false);
              
              window.dispatchEvent(new CustomEvent('toast', { detail: { message: `üéâ Agreement signed! Copies sent to ${email} and Casey.` } }));
            } catch (e) {
              console.error('Email send error:', e);
              // Still mark as signed even if email fails
              localStorage.setItem('sow_signed_at', signedAt);
              setSigned(true);
              setOpen(false);
              window.dispatchEvent(new CustomEvent('toast', { detail: { message: 'üéâ Signed! (Email delivery may be delayed)' } }));
            }
          };

          const eta = Math.max(0, deadlineTs - now);
          const fmt = (ms) => {
            const s = Math.floor(ms/1000);
            const d = Math.floor(s/86400);
            const h = Math.floor((s%86400)/3600);
            const m = Math.floor((s%3600)/60);
            const ss = s%60;
            return d>0 ? `${d}d ${h}h ${m}m ${ss}s` : `${h}h ${m}m ${ss}s`;
          };

          if (!open) return null;

          return (
            <div className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-md flex items-center justify-center p-4 overflow-y-auto">
              <div className="bg-black border-2 border-neon w-full max-w-4xl my-8 shadow-[0_0_100px_rgba(0,255,194,0.2)]">
                {/* Header */}
                <div className="p-4 border-b border-gray-800 flex items-center justify-between">
                  <div>
                    <h3 className="text-xl font-bold text-white">Let's Make It Official</h3>
                    <p className="text-sm text-gray-400">Review, sign, and we're off to the races.</p>
                  </div>
                  <div className="flex items-center gap-4">
                    {expired ? (
                      <div className="mono text-sm text-red-400">‚ö†Ô∏è Offer Expired</div>
                    ) : (
                      <div className="mono text-sm text-neon">‚è± {fmt(eta)} remaining</div>
                    )}
                    <button onClick={() => setOpen(false)} className="text-gray-400 hover:text-white text-2xl">√ó</button>
                  </div>
                </div>
                
                {/* Main Content */}
                <div className="grid grid-cols-1 lg:grid-cols-2">
                  {/* Left - SOW Preview */}
                  <div className="p-4 lg:border-r border-gray-800/50">
                    <div className="flex items-center justify-between mb-3">
                      <span className="mono text-xs text-gray-500">STATEMENT OF WORK</span>
                      <a href={pdfUrl} target="_blank" rel="noreferrer" className="text-neon text-xs hover:text-white">Open PDF ‚Üí</a>
                    </div>
                    <div className="h-[40vh] lg:h-[55vh] bg-black border border-gray-800 overflow-hidden rounded">
                      <iframe title="SOW" src={docUrl} className="w-full h-full"/>
                    </div>
                    <p className="text-xs text-gray-500 mt-2 text-center">Scroll to review</p>
                  </div>

                  {/* Right - Signing Form */}
                  <div className="p-4">
                    <div className="space-y-4">
                      {/* Step 1: Your Information */}
                      <div>
                        <div className="flex items-center gap-2 mb-2">
                          <span className="w-6 h-6 rounded-full bg-neon text-black text-xs font-bold flex items-center justify-center">1</span>
                          <span className="mono text-xs text-gray-400">YOUR INFORMATION</span>
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                          <input ref={nameRef} placeholder="Full Name *" className="col-span-2 bg-black/50 border border-gray-700 focus:border-neon p-3 text-white text-sm rounded outline-none transition-colors"/>
                          <input ref={emailRef} placeholder="Email *" type="email" className="col-span-2 bg-black/50 border border-gray-700 focus:border-neon p-3 text-white text-sm rounded outline-none transition-colors"/>
                          <input ref={titleRef} placeholder="Title" className="bg-black/50 border border-gray-700 focus:border-neon p-3 text-white text-sm rounded outline-none transition-colors"/>
                          <input ref={companyRef} placeholder="Company" className="bg-black/50 border border-gray-700 focus:border-neon p-3 text-white text-sm rounded outline-none transition-colors"/>
                        </div>
                      </div>
                      
                      {/* Step 2: Signature */}
                      <div>
                        <div className="flex items-center gap-2 mb-2">
                          <span className="w-6 h-6 rounded-full bg-neon text-black text-xs font-bold flex items-center justify-center">2</span>
                          <span className="mono text-xs text-gray-400">YOUR SIGNATURE</span>
                        </div>
                        <div className="relative">
                          <canvas ref={canvasRef} width={640} height={200} className={`w-full bg-black border-2 rounded-lg cursor-crosshair transition-all ${hasInk ? 'border-neon shadow-[0_0_20px_rgba(0,255,194,0.3)]' : 'border-gray-600 border-dashed'}`} aria-label="Sign here"></canvas>
                          {!hasInk && (
                            <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                              <span className="text-gray-600 text-sm">‚úçÔ∏è Draw your signature here</span>
                            </div>
                          )}
                        </div>
                        <div className="flex justify-between items-center mt-2">
                          <button onClick={clearSig} className="text-xs text-gray-500 hover:text-neon transition-colors">Clear</button>
                          <span className="text-xs text-gray-600">Use mouse or finger to sign</span>
                        </div>
                      </div>
                      
                      {/* Step 3: Confirm */}
                      <div>
                        <div className="flex items-center gap-2 mb-2">
                          <span className="w-6 h-6 rounded-full bg-neon text-black text-xs font-bold flex items-center justify-center">3</span>
                          <span className="mono text-xs text-gray-400">CONFIRM</span>
                        </div>
                        <label className="flex items-start gap-3 p-3 bg-black/30 border border-gray-700 rounded cursor-pointer hover:border-gray-600 transition-colors">
                          <input id="agreeTerms" type="checkbox" className="mt-1 w-4 h-4 accent-[#00FFC2]"/>
                          <span className="text-sm text-gray-300">I have reviewed and agree to the terms in the Statement of Work.</span>
                        </label>
                      </div>
                      
                      <TrustBadge />
                      
                      {/* Submit Button */}
                      <button onClick={submit} disabled={expired} className={`w-full py-4 font-bold text-lg rounded transition-all ${expired ? 'bg-gray-700 text-gray-400 cursor-not-allowed' : 'bg-neon text-black hover:bg-white'} ${!expired && !canSend ? 'pulse-glow' : ''}`}>
                        {expired ? 'Offer Expired' : canSend ? 'üöÄ Sign & Execute Agreement' : 'Sign & Execute Agreement'}
                      </button>
                      
                      {canSend && (
                        <button onClick={sendPdfEmail} className="w-full py-2 text-sm text-gray-400 border border-gray-700 rounded hover:border-neon hover:text-neon transition-colors">
                          Or send signed PDF to your email
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Fixed bottom CTA
        const FixedCTA = ({ remaining, expired, signed }) => {
          const fmt = (ms) => {
            const s = Math.floor(ms/1000);
            const d = Math.floor(s/86400);
            const h = Math.floor((s%86400)/3600);
            const m = Math.floor((s%3600)/60);
            const ss = s%60;
            return d>0 ? `${d}d ${h}h ${m}m ${ss}s` : `${h}h ${m}m ${ss}s`;
          };
          const handleClick = (e) => {
            e.preventDefault();
            notifyEvent('cta_fixed_review_sign_click', {}, { interactive: true });
            window.dispatchEvent(new CustomEvent('open-manifesto-reader'));
          };
          const status = expired ? 'Offer expired' : signed ? `‚úÖ Signed!` : `‚è± ${fmt(remaining)}`;
          const statusClass = expired ? 'text-red-400' : signed ? 'text-green-400' : 'text-neon';
          return (
            <div className="fixed bottom-0 left-0 right-0 z-40">
              <div className="mx-4 mb-4 bg-black/90 backdrop-blur-sm border border-neon px-4 py-3 flex items-center justify-between gap-3">
                <div className="flex items-center gap-3">
                  <span className={`mono text-xs ${statusClass}`}>{status}</span>
                  {!expired && !signed && <span className="text-green-400 text-xs font-bold hidden sm:inline">üí∞ $229K+ savings</span>}
                </div>
                <button onClick={handleClick} disabled={signed} className={`px-4 py-2 font-bold rounded mobile-touch-target transition-all ${signed ? 'bg-gray-700 text-gray-400 cursor-default' : 'bg-neon text-black hover:bg-white pulse-glow'}`}>
                  {signed ? 'Complete' : 'Review & Sign'}
                </button>
              </div>
            </div>
          );
        };

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (error) {
            console.error("Render Error:", error);
            document.getElementById('debug-error').style.display = 'block';
            document.getElementById('debug-error').innerHTML += `<strong>Render Error:</strong> ${error.message}<br>`;
        }
    </script>
</body>
</html>